Source: [US9906358B1](https://patents.google.com/patent/US9906358B1)

# [US9906358B1](US9906358B1.md) - Lock detector for phase lock loop

## Details

* Date: 2016-08-31
* Inventor: Kandou Labs SA
* Beneficiary: Armin Tajalli

## Other patents

### Backwards
 * US668687A
 * US780883A
 * US3196351A
 * US3636463A
 * US3939468A
 * US4163258A
 * US4181967A
 * US4206316A
 * US4276543A
 * US4486739A
 * [US4499550A](US4499550A.md)
 * US4722084A
 * US4772845A
 * US4774498A
 * US4864303A
 * US4897657A
 * [US4974211A](US4974211A.md)
 * US5017924A
 * US5053974A
 * [US5166956A](US5166956A.md)
 * US5168509A
 * US5266907A
 * US5283761A
 * US5287305A
 * US5311516A
 * US5331320A
 * [US5412689A](US5412689A.md)
 * US5449895A
 * US5459466A
 * US5461379A
 * US5511119A
 * US5553097A
 * US5566193A
 * US5599550A
 * US5629651A
 * US5659353A
 * US5727006A
 * US5748948A
 * US5802356A
 * [US5825808A](US5825808A.md)
 * US5856935A
 * US5875202A
 * US5945935A
 * US5949060A
 * US5982954A
 * US5995016A
 * US5999016A
 * [US6005895A](US6005895A.md)
 * [US6084883A](US6084883A.md)
 * US6119263A
 * US6172634B1
 * US6175230B1
 * US6232908B1
 * [US6278740B1](US6278740B1.md)
 * US6316987B1
 * US6346907B1
 * US20020044316A1
 * US6378073B1
 * US20020057592A1
 * US6398359B1
 * US6404820B1
 * US6417737B1
 * US6433800B1
 * [US6452420B1](US6452420B1.md)
 * US20020154633A1
 * US6473877B1
 * US6483828B1
 * US20020174373A1
 * US20020181607A1
 * US6509773B2
 * US20030016770A1
 * US6522699B1
 * [US6556628B1](US6556628B1.md)
 * US20030085763A1
 * US6563382B1
 * JP2003163612A
 * US20030146783A1
 * US6621427B2
 * US20030174023A1
 * US6624699B2
 * US6650638B1
 * [US6661355B2](US6661355B2.md)
 * US6664355B2
 * US6686879B2
 * US20040027185A1
 * [US6766342B2](US6766342B2.md)
 * US20040146117A1
 * US20040155802A1
 * US20040161019A1
 * US20040169529A1
 * [US6839429B1](US6839429B1.md)
 * US6839587B2
 * US6854030B2
 * US6865234B1
 * US6865236B1
 * US20050063493A1
 * US6876317B2
 * US20050134380A1
 * US6927709B2
 * US20050174841A1
 * US20050213686A1
 * US20050220182A1
 * [US6954492B1](US6954492B1.md)
 * US6963622B2
 * US6973613B2
 * US6972701B2
 * US6976194B2
 * US6982954B2
 * [US6990138B2](US6990138B2.md)
 * US6993311B2
 * US6991038B2
 * [US6999516B1](US6999516B1.md)
 * US7023817B2
 * US7039136B2
 * US20060097786A1
 * US20060103463A1
 * US7053802B2
 * US20060120486A1
 * US20060126751A1
 * US20060133538A1
 * US20060140324A1
 * US7075996B2
 * US7080288B2
 * US20060159005A1
 * US7082557B2
 * US7085336B2
 * US7085153B2
 * US7127003B2
 * US7142865B2
 * [US7142612B2](US7142612B2.md)
 * US20070002954A1
 * US20070001723A1
 * US7164631B2
 * US7167019B2
 * US20070030796A1
 * [US7180949B2](US7180949B2.md)
 * US7199728B2
 * US20070121716A1
 * US7231558B2
 * US20070204205A1
 * US7269130B2
 * US7269212B1
 * US20070263711A1
 * US20070283210A1
 * US20080007367A1
 * US20080012598A1
 * US7336112B1
 * US7335976B2
 * US7339990B2
 * US7346819B2
 * US7348989B2
 * US7356213B1
 * US7358869B1
 * US7362697B2
 * US7366942B2
 * US20080104374A1
 * US7370264B2
 * US7372390B2
 * [US7389333B2](US7389333B2.md)
 * US20080159448A1
 * US7397302B2
 * US7400276B1
 * US20080192621A1
 * US7456778B2
 * US7462956B2
 * US20080317188A1
 * US7496162B2
 * US20090059782A1
 * EP2039221A1
 * US7535957B2
 * US7539532B2
 * CN101478286A
 * WO2009084121A1
 * US20090195281A1
 * US7599390B2
 * US20090262876A1
 * US7616075B2
 * US7620116B2
 * [US7633850B2](US7633850B2.md)
 * US20090316730A1
 * US7639596B2
 * US20090323864A1
 * US7650525B1
 * US7656321B2
 * US20100046644A1
 * WO2010031824A1
 * US20100081451A1
 * US7694204B2
 * US7697915B2
 * US7698088B2
 * US7706456B2
 * US7706524B2
 * US20100180143A1
 * US7768312B2
 * US20100215112A1
 * US20100215087A1
 * US7787572B2
 * US20100235673A1
 * US7804361B2
 * US7808456B2
 * US20100296556A1
 * US7841909B2
 * US20100309964A1
 * US7869546B2
 * US7869497B2
 * US20110014865A1
 * US7882413B2
 * US7899653B2
 * US20110051854A1
 * US20110072330A1
 * US20110084737A1
 * US7933770B2
 * US8000664B2
 * WO2011119359A2
 * US8030999B2
 * US8036300B2
 * US8050332B2
 * US20110268225A1
 * US8055095B2
 * US8064535B2
 * US20110302478A1
 * [US20110299555A1](US20110299555A1.md)
 * US8085172B2
 * US20110317559A1
 * US8106806B2
 * US8149906B2
 * [US8159376B2](US8159376B2.md)
 * US8180931B2
 * US8185807B2
 * US8199863B2
 * US8199849B2
 * US20120152901A1
 * US20120161945A1
 * US8218670B2
 * US8233544B2
 * US8245094B2
 * US20120213299A1
 * US8253454B2
 * US8279094B2
 * US8279745B2
 * US20120257683A1
 * US8289914B2
 * US8295336B2
 * US8295250B2
 * US8310389B1
 * US8341492B2
 * US20130010892A1
 * US20130013870A1
 * US8359445B2
 * US8365035B2
 * US8406316B2
 * US8429492B2
 * US8429495B2
 * US8437440B1
 * US20130114519A1
 * US8442099B1
 * US8443223B2
 * US20130147553A1
 * US8472513B2
 * US20130188656A1
 * US8498368B1
 * US20130195155A1
 * US8520348B2
 * US8547272B2
 * US20130259113A1
 * US20130271194A1
 * US8578246B2
 * US8588254B2
 * US8593305B1
 * US20130314142A1
 * US20130315501A1
 * US8602643B2
 * US8604879B2
 * US20130346830A1
 * US8620166B2
 * US8638241B2
 * US8643437B2
 * US8649840B2
 * US8649556B2
 * US8649460B2
 * US8674861B2
 * US8687968B2
 * US8718184B1
 * US8755426B1
 * US8773964B2
 * US8782578B2
 * US8780687B2
 * US8831440B2
 * US8879660B1
 * US8898504B2
 * US8938171B2
 * US8951072B2
 * US8975948B2
 * US20150078479A1
 * US8989317B1
 * US9036764B1
 * US20150146771A1
 * US9059816B1
 * US9069995B1
 * US9077386B1
 * US9083576B1
 * US9093791B2
 * US9100232B1
 * US9124557B2
 * US9148087B1
 * US9152495B2
 * US9172412B2
 * US9178503B2
 * US9183085B1
 * US20150333940A1
 * US9197470B2
 * US20150349835A1
 * US20150381232A1
 * US20150380087A1
 * US20160020796A1
 * US20160020824A1
 * US20160036616A1
 * US9281785B2
 * [US9288082B1](US9288082B1.md)
 * US9292716B2
 * US9300503B1
 * US9306621B2
 * US9331962B2
 * US9363114B2
 * US9374250B1
 * US9432298B1
 * US9455744B2
 * US9455765B2
### Forward
 * US20170317855A1
 * US20170366191A1
 * US10324876B2
 * US20190198131A1
 * US10347283B2
 * US10374787B2
 * US10404394B2
 * US10411922B2
 * US10488227B2
 * [US10554380B2](US10554380B2.md)
 * US10630272B1
 * US10673443B1
## Abstract

Abstract

Methods and systems are described for generating, using a voltage-controlled oscillator (VCO), a plurality of phases of a local clock signal, generating a phase-error signal using a phase comparator receive a phase of the local clock signal and a reference clock signal, and configured to output the phase-error signal, generating a frequency-lock assist (FLA) signal using a FLA circuit receiving one or more phases of the local clock signal and the reference clock signal, the FLA signal indicative of a magnitude of a frequency error between the reference clock signal and the local clock signal, and generating a VCO control signal using an error accumulator circuit receiving the phase-error signal and the FLA signal, and responsively providing the VCO control signal to the VCO to lock the local clock signal to the reference clock signal.



Methods and systems are described for generating, using a voltage-controlled oscillator (VCO), a plurality of phases of a local clock signal, generating a phase-error signal using a phase comparator receive a phase of the local clock signal and a reference clock signal, and configured to output the phase-error signal, generating a frequency-lock assist (FLA) signal using a FLA circuit receiving one or more phases of the local clock signal and the reference clock signal, the FLA signal indicative of a magnitude of a frequency error between the reference clock signal and the local clock signal, and generating a VCO control signal using an error accumulator circuit receiving the phase-error signal and the FLA signal, and responsively providing the VCO control signal to the VCO to lock the local clock signal to the reference clock signal.

REFERENCES
The following prior applications are herein incorporated by reference in their entirety for all purposes:
U.S. Patent Publication 2011/0268225 of application Ser. No. 12/784,414, filed May 20, 2010, naming Harm Cronie and Amin Shokrollahi, entitled “Orthogonal Differential Vector Signaling” (hereinafter “Cronie I”).
U.S. Patent Publication 2011/0302478 of application Ser. No. 12/982,777, filed Dec. 30, 2010, naming Harm Cronie and Amin Shokrollahi, entitled “Power and Pin Efficient Chip-to-Chip Communications with Common-Mode Resilience and SSO Resilience” (hereinafter “Cronie II”).
U.S. patent application Ser. No. 13/030,027, filed Feb. 17, 2011, naming Harm Cronie, Amin Shokrollahi and Armin Tajalli, entitled “Methods and Systems for Noise Resilient, Pin-Efficient and Low Power Communications with Sparse Signaling Codes” (hereinafter “Cronie III”).
U.S. patent application Ser. No. 13/176,657, filed Jul. 5, 2011, naming Harm Cronie and Amin Shokrollahi, entitled “Methods and Systems for Low-power and Pin-efficient Communications with Superposition Signaling Codes” (hereinafter “Cronie IV”).
U.S. patent application Ser. No. 13/542,599, filed Jul. 5, 2012, naming Armin Tajalli, Harm Cronie, and Amin Shokrollahi entitled “Methods and Circuits for Efficient Processing and Detection of Balanced Codes” (hereafter called “Tajalli I”.)
U.S. patent application Ser. No. 13/842,740, filed Mar. 15, 2013, naming Brian Holden, Amin Shokrollahi and Anant Singh, entitled “Methods and Systems for Skew Tolerance in and Advanced Detectors for Vector Signaling Codes for Chip-to-Chip Communication”, hereinafter identified as [Holden I];
U.S. Provisional Patent Application No. 61/946,574, filed Feb. 28, 2014, naming Amin Shokrollahi, Brian Holden, and Richard Simpson, entitled “Clock Embedded Vector Signaling Codes”, hereinafter identified as [Shokrollahi I].
U.S. patent application Ser. No. 14/612,241, filed Aug. 4, 2015, naming Amin Shokrollahi, Ali Hormati, and Roger Ulrich, entitled “Method and Apparatus for Low Power Chip-to-Chip Communications with Constrained ISI Ratio”, hereinafter identified as [Shokrollahi II].
U.S. patent application Ser. No. 13/895,206, filed May 15, 2013, naming Roger Ulrich and Peter Hunt, entitled “Circuits for Efficient Detection of Vector Signaling Codes for Chip-to-Chip Communications using Sums of Differences”, hereinafter identified as [Ulrich I].
U.S. patent application Ser. No. 14/816,896, filed Aug. 3, 2015, naming Brian Holden and Amin Shokrollahi, entitled “Orthogonal Differential Vector Signaling Codes with Embedded Clock”, hereinafter identified as [Holden II].
U.S. patent application Ser. No. 14/926,958, filed Oct. 29, 2015, naming Richard Simpson, Andrew Stewart, and Ali Hormati, entitled “Clock Data Alignment System for Vector Signaling Code Communications Link”, hereinafter identified as [Stewart I].
U.S. patent application Ser. No. 14/925,686, filed Oct. 28, 2015, naming Armin Tajalli, entitled “Advanced Phase Interpolator”, hereinafter identified as [Tajalli II].
U.S. Provisional Patent Application No. 62/286,717, filed Jan. 25, 2016, naming Armin Tajalli, entitled “Voltage Sampler Driver with Enhanced High-Frequency Gain”, hereinafter identified as [Tajalli III].
The following additional references to prior art have been cited in this application:
“Linear phase detection using two-phase latch”, A. Tajalli, et al., IEE Electronic Letters, 2003, (hereafter called [Tajalli IV].)
FIELD OF THE INVENTION
The present embodiments relate to communications systems circuits generally, and more particularly to obtaining a stable, correctly phased receiver clock signal from a high-speed multi-wire interface used for chip-to-chip communication.
BACKGROUND
In modern digital systems, digital information has to be processed in a reliable and efficient way. In this context, digital information is to be understood as information available in discrete, i.e., discontinuous values. Bits, collection of bits, but also numbers from a finite set can be used to represent digital information.
In most chip-to-chip, or device-to-device communication systems, communication takes place over a plurality of wires to increase the aggregate bandwidth. A single or pair of these wires may be referred to as a channel or link and multiple channels create a communication bus between the electronic components. At the physical circuitry level, in chip-to-chip communication systems, buses are typically made of electrical conductors in the package between chips and motherboards, on printed circuit boards (“PCBs”) boards or in cables and connectors between PCBs. In high frequency applications, microstrip or stripline PCB traces may be used.
Common methods for transmitting signals over bus wires include single-ended and differential signaling methods. In applications requiring high speed communications, those methods can be further optimized in terms of power consumption and pin-efficiency, especially in high-speed communications. More recently, vector signaling methods have been proposed to further optimize the trade-offs between power consumption, pin efficiency and noise robustness of chip-to-chip communication systems. In those vector signaling systems, digital information at the transmitter is transformed into a different representation space in the form of a vector codeword that is chosen in order to optimize the power consumption, pin-efficiency and speed trade-offs based on the transmission channel properties and communication system design constraints. Herein, this process is referred to as “encoding”. The encoded codeword is communicated as a group of signals from the transmitter to one or more receivers. At a receiver, the received signals corresponding to the codeword are transformed back into the original digital information representation space. Herein, this process is referred to as “decoding”.
Regardless of the encoding method used, the received signals presented to the receiving device must be sampled (or their signal value otherwise recorded) at intervals best representing the original transmitted values, regardless of transmission channel delays, interference, and noise. This Clock and Data Recovery (CDR) not only must determine the appropriate sample timing, but must continue to do so continuously, providing dynamic compensation for varying signal propagation conditions.
Many known CDR systems utilize a Phase-Locked Loop (PLL) or Delay-Locked Loop (DLL) to synthesize a local receive clock having an appropriate frequency and phase for accurate receive data sampling.
BRIEF DESCRIPTION
To reliably detect the data values transmitted over a communications system, a receiver must accurately measure the received signal value amplitudes at carefully selected times. Various methods are known to facilitate such receive measurements, including reception of one or more dedicated clock signals associated with the transmitted data stream, extraction of clock signals embedded within the transmitted data stream, and synthesis of a local receive clock from known attributes of the communicated data stream.
In general, the receiver embodiments of such timing methods are described as Clock-Data Recovery (CDR), often based on Phase-Lock Loop (PLL) or Delay-Locked Loop (DLL) synthesis of a local receive clock having the desired frequency and phase characteristics.
In both PLL and DLL embodiments, a Phase Detector compares the relative phase (and in some variations, the relative frequency) of a received reference signal and a local clock signal to produce an error signal, which is subsequently used to correct the phase and/or frequency of the local clock source and thus minimize the error. As this feedback loop behavior will lead to a given PLL embodiment producing a fixed phase relationship (as examples, 0 degrees or 90 degrees of phase offset) between the reference signal and the local clock, an additional fixed or variable phase adjustment is often introduced to permit the phase offset to be set to a different desired value (as one example, 45 degrees of phase offset) to facilitate receiver data detection.
In some embodiments, the operating range of the local clock source may be sufficiently wide that a phase lock may occur between harmonic multiples of the reference and local clock signals (e.g. the local clock operating spuriously at one half or twice its normal frequency) especially at system startup. A lock detector is described which may be configured to detect and correct this anomalous behavior.

BRIEF DESCRIPTION OF FIGURES
 FIG. 1 is a block diagram of one embodiment capable of encoding and transmitting five data bits and a clock on an eight wire communications channel.
 FIG. 2 is a block diagram of one embodiment of a receiver compatible with the transmitter of FIG. 1.
 FIG. 3 is a block diagram detailing one embodiment of the clock recovery circuit used by the receiver of FIG. 2.
 FIG. 4 shows details of the loop filter, VCO, and associated circuits of FIG. 3.
 FIG. 5 is a schematic diagram of one embodiment of a Frequency Lock Assist circuit.
 FIG. 6A shows one embodiment computing a 1−z−1 term of a Frequency Lock Assist circuit.
 FIG. 6B shows one embodiment computing a 1−z−2 term of a Frequency Lock Assist circuit.
 FIG. 7 is a graph showing the transfer functions of 1−z−1 and 1−z−2 terms of a Frequency Lock Assist (FLA) circuit.
 FIG. 8 is a diagram illustrating frequency-locking of a local clock signal, in accordance with some embodiments.
 FIG. 9 is a diagram illustrating operation of a FLA circuit, in accordance with some embodiment.
 FIG. 10 is a diagram illustrating operation of a FLA circuit, in accordance with some embodiments.
 FIG. 11 is a diagram illustrating operation of a FLA circuit, in accordance with some embodiments.
 FIG. 12 is a flowchart of a method, in accordance with some embodiments.
 FIG. 13 is a schematic of an XOR gate, in accordance with some embodiments.

DETAILED DESCRIPTION
Phase Locked Loops (PLLs) are well represented in the literature. A typical PLL is composed of a phase detector that compares an external reference signal to an internal clock signal, a low pass filter that smooths the resulting error value to produce a clock control signal, and a variable frequency clock source (typically, a Voltage Controlled Oscillator or VCO) controlled by the smoothed error value, producing the internal clock signal presented to the phase detector. In a well-known variation, such a PLL design may incorporate a clock frequency divider between the VCO and the phase detector, allowing a higher-frequency clock output to be phase locked to a lower-frequency reference signal.
In an alternative embodiment, the variable frequency clock source is replaced by a variable delay element, its (optionally multiple tapped) outputs thus representing one or more successive time-delayed versions of the original input signal rather than successive cycles of an oscillator to be phase compared to the reference input signal. For the purposes of this document, such Delay Locked Loops (DLL) are considered functionally equivalent to a PLL in such an application.
Numerous forms of PLL phase detectors, also known as phase comparators, are known to the art. A popular embodiment is composed of a digital finite state machine with state changes driven by signal edges of the external reference clock and the internal clock signal. Such a state machine can be designed and configured to be sensitive to both phase differences between the two clock signals, and to gross frequency differences between those signals as well. In some embodiments, a state machine phase detector also provides an indication that the PLL has locked. The combination of phase and frequency sensitivity permits such a detector to accelerate the initial acquisition of PLL lock, e.g. at system startup, where the two clock signals may have significant frequency differences.
An edge-clocked D flip-flop may be used as a digital phase comparator, producing a “1” output if a first clock signal presented at the D input has already transitioned when a second clock signal used as the flip-flop clock transitions, and produces an “0” output if the first clock signal has not yet transitioned. Such “bang-bang” phase detector behavior (i.e. either fully on or fully off) may require significant smoothing by the PLL loop filter to maintain loop stability.
A simple XOR gate is also commonly used as a phase comparator in PLL embodiments in which its simple, low-latency design leads to advantageous high loop bandwidth. Unlike the previous example, the digital waveform produced by XORing, for example, a first and a second square wave clock signal smoothly varies its duty cycle with phase differences between the clocks. FIG. 13 is a schematic of an exemplary XOR 320 that may be used to generate a current-mode output. Also shown in FIG. 13 are biasing circuits that
However, any such detector sensitive only to phase may erroneously drive the VCO in the wrong direction when there is significant frequency difference between the first and second clocks, such as at system startup, before ultimately capturing a phase relationship leading to PLL lock. In embodiments utilizing a VCO covering a broad frequency range, a phase-only detector may also allow the PLL to erroneously lock with the VCO operating at a multiple or fraction of the correct frequency. Such anomalous or pseudo-lock conditions may be avoided by use of a phase and frequency comparator as known in the art, such as the earlier example based on a finite state machine.
Unless otherwise specified within this document, a phase locked loop may be composed of any known embodiment of a phase detector, voltage controlled oscillator, and loop filter, without limitation.
Receiver Clock Recovery
One data receiver embodiment FIG. 2 utilizes a PLL-based clock recovery subsystem as shown in FIG. 3. This PLL accepts the received clock signal MIC5 as the reference clock to which the locally-generated clocks will be phased locked. Phase Comparator 320 compares the reference clock to a local clock derived from Voltage Controlled Oscillator or VCO 340, producing an output which is low pass filtered 330 to provide an Error result which subsequently corrects the VCO operating frequency. In some embodiments, the outputs of Phase Comparator 320 is a digital waveform which is subsequently converted to an analog error signal, either through implicit or explicit digital to analog conversion, or by use of an interface element such as a charge pump. Some embodiments may combine such conversion with all or part of the low pass filtering operation, as one example offered without limitation by the digital filtering behavior shown by the switching action of a charge pump directed by digital control signals generating an analog signal output.
In one embodiment, a ring oscillator composed of a sequence of identical digital logic elements such as gates, inverters, or buffers in a closed loop is used as the internal Voltage Controlled Oscillator (VCO) timing source for the PLL. The ring oscillator frequency is varied by analog adjustment of at least one of: gate propagation delay, inter-gate rise and fall time, and gate switching threshold within the ring oscillator. In some embodiments, this is implemented via switched capacitor banks, where a digital control signal is applied to selectively place capacitive elements in parallel and/or series combinations to alter an RC time constant, as one non-limiting example. In further embodiments, one or more current sources within ring oscillator elements may be increased or decreased to alter that element's switching threshold and/or output rise-time/fall-time, and thereby adjust its effective delay.
In some embodiments, outputs are taken at equal intervals (i.e. separated by equal numbers of ring oscillator gates) along the sequence of gates comprising the ring oscillator to provide multiple clock phases, as identified here as VCO(0), VCO(2), VCO(4), and VCO(6) clocks. Some embodiments may also incorporate a phase interpolator 360 which, under control of Clock/Data phase control logic 370, can be configured to incrementally offset the fixed phase relationship obtained under lock conditions so as to align the resulting clock phases with desirable data sampling intervals. In some embodiments, it is desired that the VCO operate at a multiple of the received reference clock frequency, thus Frequency Divider 350 divides the VCO outputs by a comparable amount prior to the Phase Detector. As non-limiting examples, in one embodiment binary (factor of two) dividers are used at 350 to obtain the correct sampling clock rate, while in another embodiment no divider is required and the VCO outputs are used directly.
Adjustable ring oscillator VCOs are capable of a very wide operating range, in one embodiment demonstrating controlled oscillation over considerably more than a 4:1 frequency range, potentially allowing the PLL to erroneously lock at one-half the desired clock rate or at twice the desired clock rate. Combining the ring oscillator VCO with a phase- and frequency-detector such as the previously described State Machine phase detector to control startup frequency was contra-indicated in this embodiment, however, as that form of phase comparator could not provide sufficient PLL bandwidth during lock to meet phase jitter specifications.
Frequency Lock Assist
A new embodiment composed of the phase detector, error accumulator, and VCO elements of FIG. 3 is shown in FIG. 4. Without implying limitation, a ring of four differential buffer/inverter stages is shown serving as a voltage-controlled oscillator, with the propagation delay of each buffer/inverter stage controlled by control signal Delay Control. The four positive and four negative ring oscillator outputs provide eight distinct local clock signal output phases VCO(0) through VCO(7).
Also without implying limitation, an XOR gate phase detector producing a current output is illustrated at 320. Its simple design and low latency enables high PLL bandwidth and low jitter, but its lack of frequency discrimination introduces the risk of anomalous or pseudo-locked operation at system startup. To avoid such undesirable operation an additional source of VCO control, Frequency Lock Assist 400, is utilized to force the VCO into an operational range within which the normal phase comparator will correctly operate. The Frequency Lock Assist may also be configured to provide a useful PLL lock indication, independent of the type of phase detector used.
In the embodiment of FIG. 4, a VCO control signal including the control signal FLA produced by Frequency Lock Assist 400 is presented to an error accumulator circuit 430, shown in FIG. 4 as a PLL loop filter, without implying limitation. The FLA signal is presented as a current at the capacitive node, thus producing a first-order feedback loop during startup. In contrast, the phase-error signal produced by phase comparator 320 is presented to error accumulator circuit 430 via resistor Rfilter, producing a second-order feedback loop during normal PLL operation. In some embodiments, the FLA signal quickly charges/discharges the capacitor shown in the loop filter to set the VCO in a frequency-locked condition, and the phase-error signal subsequently fine-tunes the capacitor to set the VCO into a phase and frequency-locked condition. At least one embodiment powers down the circuitry associated with Frequency Lock Assist 400 once normal PLL lock (or Frequency lock condition) has been obtained to reduce system power utilization. Another alternative embodiment utilizes a digital or analog switch to select between Frequency Lock Assist 400 and normal phase comparator 320 as the source of loop control signal Error. In such embodiments, the switch may allow the FLA 400 to quickly set the VCO in a frequency-locked condition, and then the switch may switch to enable the phase-error signal to fine-tune the phase of the VCO. It should be noted that alternative embodiments may present the phase detection and FLA outputs to the same input of a PLL loop filter.
One embodiment of Frequency Lock Assist 400 is shown in detail in FIG. 5. As shown in FIG. 5, the FLA 400 includes a plurality of FLA sub-circuits as shown in FIG. 6A for computing frequency differences 1−z−1 by determining if a local clock phase (one example being the clock VCO(0)/4) derived from the local VCO clock has or has not changed state one or more times between consecutive ticks of the external reference signal CKREF/4. In this embodiment, eight distinct phases of the VCO local clock are individually used to compute a 1−z−1 term, the results of which are summed using a summation unit 510 to produce the resulting control output FLA. In one embodiment, 510 produces an analog summation of the smoothed analog level of its inputs; in other embodiments, the summation is performed digitally. One such embodiment utilizes XOR gates producing current-mode outputs, which may conveniently be summed at a common node to produce the FLA signal.
 FIG. 8 illustrates the frequency of the VCO local clock signal over time, in accordance with some embodiments. As shown, the VCO local clock signal locks to a frequency of about 6.25 GHz. In some embodiments, CKREF may have a frequency of ˜6.25 GHz, and at the receiver, multiple phases of a local clock signal VCO(0-7) are generated at ˜6.25 GHz, which may be used to sample MIC outputs MIC0-MIC5 using samplers in processing phases 230, for example at a rate of ˜25 GHZ. All numbers are provided for example only, and should not be considered limiting.
 FIGS. 9-11 illustrate the outputs of the XOR gates for each FLA sub-circuit, as shown in FIG. 5, according to various quartered VCO frequencies of VCO/4. FIG. 9 illustrates a scenario where VCO/4 is at an extreme low case of 0 Hz (a DC signal). As shown, at each sampling instant t1-t4, none of the latched values change from the previously latched value, and thus each XOR of each FLA sub-circuit outputs a current-mode ‘1’ (in current-mode output) at each sampling instant, for a cumulative FLA signal value of 8.
 FIG. 10 illustrates another extreme case, where VCO/4 is equal to CKREF/2. As shown, at each sampling instant t1-t4, each latched value changes from the previous latched value for each of the plurality of local clock phases, thus each XOR in each FLA sub-circuit outputs a current-mode ‘−1’ value, for a cumulative FLA signal value of −8.
 FIG. 11 illustrates an example of the FLA in frequency-locked condition. In some embodiments, the frequency-lock condition occurs when VCO/4 is equal to CKREF/4. As shown in FIG. 11, at any given sampling instant t1-t4, half of the previously latched values have changed from the current latched values, and thus half of the XOR outputs will be ‘1’ while the other half will be ‘−1’, resulting in a cumulative FLA signal value of 0.
Referring back to FIG. 5, it should be pointed out for clarity that in an embodiment, CKREF may have a frequency of 6.25 GHz. In some embodiments, CKREF may have been divided by some factor from an original symbol clock rate. In some embodiments, the original symbol rate may be equal to 25 GHz, in some embodiments. Such embodiments should not be considered limiting. Further, as each VCO phase is quartered prior to entering the FLA sub-circuits shown in FIG. 5, VCO/4 will equal 1.5625 GHz in lock condition (or CKREF/4, as described above with respect to FIG. 11), and thus the frequency of the VCO phases will be equal to 6.25 GHz, i.e. VCO=CKREF.
Further, it should be noted that in the examples described above, the maximum frequency that VCO could start is 2*CKREF (12.5 GHz in the specific example described above), as shown by the scenario of FIG. 10. If VCO>2*CKREF, the outputs of each FLA sub-circuit may be randomized, potentially giving an average FLA value of 0, which would indicate lock condition.
It should be noted that the above numerical examples are provided purely for example, and should not be considered in any way as limiting the scope of described embodiments.
In some embodiments, an apparatus includes a VCO 340 configured to provide a plurality of phases VCO(N) of a local clock signal. A phase comparator 320 is configured to receive a phase VCO(i) of the local clock signal and a reference clock signal CKREF, and configured to output a phase-error signal. An FLA circuit 400 is configured to receive one or more phases VCO(N) of the local clock signal and the reference clock signal, and to generate an FLA signal indicative of a magnitude of a frequency error between the reference clock signal CKREF and the local clock signal. The apparatus further includes an error accumulator circuit 430 configured to receive the phase-error signal and the FLA signal, and to responsively provide to the VCO 340 a VCO control signal to lock the local clock signal to the reference clock signal.
In some embodiments, the error accumulator circuit 430 is a loop filter. In some embodiments, the phase-error signal is received at a second-order input of the loop filter and wherein the FLA signal is received at a first-order input of the loop filter. In some embodiments, the loop filter is a resistor-capacitor (RC) filter, and the second-order input is at a resistive input of the RC filter and the first-order input is at a capacitive input of the RC filter.
In some embodiments, the FLA signal is configured to set the VCO 340 in a frequency-lock condition, and subsequently the phase-error signal sets the VCO 340 in a frequency and phase-locked condition.
In some embodiments, the VCO 340 comprises a delay-control transistor, and the VCO control signal sets an operating voltage for the delay-control transistor. In some embodiments, the delay-control transistor adjusts delay characteristics of delay elements in the VCO 340. In some embodiments, the delay-control transistor is configured to adjust an RC time-constant of at least one delay element. In some embodiments, the delay-control transistor is configured to adjust a current through the delay elements in the VCO.
In some embodiments, FLA circuit 400 includes a plurality of FLA sub-circuits, each FLA sub-circuit configured to receive (i) a respective phase of the plurality of phases of the local clock signal and (ii) the reference clock signal, and to output a partial FLA signal, and a summation unit configured to receive each partial FLA signal and to generate the FLA signal.
In some embodiments, each partial FLA signal is a current signal and the summation unit performs an analog summation at a common node connected to all of the FLA partial signals. In some embodiments, the FLA circuit comprises 8 FLA sub-circuits, and the FLA signal has a range of values from −8 to +8.
In some embodiments, each FLA sub-circuit is a first order sub-circuit, each sub-circuit includes a first and a second D Flip-Flop arranged in a shift register configuration, the first and second D Flip-Flops configured to latch values of the respective phase of the local clock signal according to adjacent edges the reference clock signal, and an XOR connected to the output of each D Flip-Flop, the XOR configured to receive the latched values and to generate the partial FLA signal. An example of such an FLA sub-circuit is shown in FIG. 6A.
In some embodiments, each FLA sub-circuit is a second order circuit, each sub-circuit including three D Flip-Flops arranged in a shift register configuration, a first and third D Flip-Flop configured to latch values of the respective phase of the local clock signal according to edges of the reference clock signal that are separated by a unit interval, and an XOR connected to the first and the third D Flip-Flop, the XOR configured to receive the latched values and to generate the partial FLA signal. An example of such an FLA sub-circuit is shown in FIG. 6B.
It should be noted that embodiments described above compute 1−z−1 based on the reference clock rate, comparing it to the VCO clock rate divided by four. However, in the particular example of the communications system of FIG. 1, the clock signal is transmitted at one-half the data rate, (i.e. a divide-by-two action is performed at the transmitter.) Thus, as shown in FIG. 5, the Reference Clock received as MIC5 is effectively CKREF. The corresponding VCO frequencies VCO(N) are divided by four to produce the corresponding local clock comparison signals. The resulting transfer characteristic of the FLA is shown as 720 in FIG. 7.
Assuming that the maximum VCO frequency that may transiently occur at startup (2*CKREF) results in each of VCO(N)/4 in FIG. 4 completing a full square wave cycle between consecutive rising edges of clock CKREF, every XOR gate will produce an output 1−z−1(N) that is true (e.g., ‘−1’ in current-mode output), thus the cumulative FLA will be at a maximum. Conversely, a minimum VCO frequency (e.g., 0 Hz) results in none of VCO(N)/4 changing between consecutive rising edges of CKREF, causing every XOR gate to produce a false output (e.g., ‘1’ in current-mode output), resulting in a minimum cumulative FLA. At or near the PLL lock frequency (VCO=CKREF), approximately half of the XOR gates will detect that their corresponding VCO(N)/4 has changed, thus the cumulative FLA will be half way between its maximum and minimum values. In an alternative embodiment, the above values may be inverted, in which the FLA signal may be +V at maximum, −V at minimum, and PLL lock will be a value of zero.
If the operational frequency range of the VCO is even wider, a Frequency Lock Assist circuit utilizing 1−z−2 terms or even higher order terms may be used. As shown as 730 in FIG. 7, the positive slope of these second-order terms extends over a wider frequency range. The overall circuit is as shown in FIG. 4, except the individual terms are computed using the second-order FLA sub-circuit of FIG. 6B rather than the first-order FLA sub-circuit of FIG. 6A.
 FIG. 12 illustrates a flowchart of a method 1200, in accordance with some embodiments. As shown, method 1200 includes generating, at block 1202, using a voltage-controlled oscillator (VCO), a plurality of phases of a local clock signal. At block 1204, the method generates a phase-error signal using a phase comparator receive a phase of the local clock signal and a reference clock signal, and configured to output the phase-error signal. At block 1206, the method generates a frequency-lock assist (FLA) signal using a FLA circuit receiving one or more phases of the local clock signal and the reference clock signal, the FLA signal indicative of a magnitude of a frequency error between the reference clock signal and the local clock signal. At block 1208, the method generates a VCO control signal using an error accumulator circuit receiving the phase-error signal and the FLA signal, and responsively providing the VCO control signal to the VCO to lock the local clock signal to the reference clock signal.
In some embodiments, the error accumulator circuit is a loop filter. In some embodiments, the method further includes receiving the phase-error signal at a second-order input of the loop filter and receiving the FLA signal at a first-order input of the loop filter.
In some embodiments, the loop filter is a resistor-capacitor (RC) filter, the second-order input is at a resistive input of the RC filter and the first-order input is at a capacitive input of the RC filter.
In some embodiments, the FLA signal sets the VCO in a frequency-lock condition, and subsequently the phase-error signal sets the VCO in a frequency and phase-locked condition.
In some embodiments, the VCO control signal sets an operating voltage for a delay-control transistor in the VCO. In some embodiments, the method further includes adjusting the delay-control transistor to delay characteristics of delay elements in the VCO. In some embodiments, the method further includes adjusting an RC time-constant of at least one delay element in the VCO. In some embodiments, the method further includes adjusting current through at least one delay element in the VCO.
In some embodiments, the method 1200 further includes receiving, at a FLA sub-circuit of a plurality of FLA sub-circuits, a respective phase of the plurality of phases of the local clock signal and the reference clock signal, and responsively forming a partial FLA signal, and generating the FLA signal by summing the partial FLA signal from each FLA sub-circuit using a summation unit.
In some embodiments, each FLA sub-circuit is a first order sub-circuit, and generating each partial FLA circuit includes latching values of the respective phase of the local clock signal according to adjacent edges the reference clock signal and generating the partial FLA signal based on the latched values.
In some embodiments, each FLA sub-circuit is a second order circuit, and generating each partial FLA circuit includes latching values of the respective phase of the local clock signal according to edges of the reference clock signal that are separated by a unit interval and generating the partial FLA signal based on the latched values.
In some embodiments, each partial FLA signal is a current signal and wherein generating the FLA signal includes performing an analog summation at a common node connected to all of the FLA partial signals. In some embodiments, the FLA circuit comprises 8 FLA sub-circuits as shown in FIG. 5, and the FLA signal has a range of values from −8 to +8.

The invention claimed is:
 
1. An apparatus comprising:
a voltage-controlled oscillator (VCO) configured to provide a plurality of phases of a local clock signal;
a phase comparator configured to receive a phase of the local clock signal and a reference clock signal, and configured to detect a phase error between the phase of the local clock signal and the reference clock and to responsively output a phase-error signal;
a frequency-lock assist (FLA) circuit configured to receive two or more phases of the local clock signal and the reference clock signal, and configured to generate an FLA signal by detecting a number of phases of the two or more phases of the local clock signal having transitions of latched values, the FLA signal indicative of a magnitude of a frequency error between the reference clock signal and the local clock signal; and
an error accumulator circuit configured to receive the phase-error signal and the FLA signal, and to responsively provide to the VCO a VCO control signal to lock the local clock signal to the reference clock signal.


  
2. The apparatus of claim 1, wherein the error accumulator circuit is a loop filter.

  
3. The apparatus of claim 2, wherein the phase-error signal is received at a second-order input of the loop filter and wherein the FLA signal is received at a first-order input of the loop filter.

  
4. The apparatus of claim 3, wherein the loop filter is a resistor-capacitor (RC) filter, and wherein the second-order input is at a resistive input of the RC filter and the first-order input is at a capacitive input of the RC filter.

  
5. The apparatus of claim 1, wherein the FLA signal is configured to set the VCO in a frequency-lock condition, and subsequently the phase-error signal sets the VCO in a frequency and phase-locked condition.

  
6. The apparatus of claim 1, wherein the VCO comprises a delay-control transistor, and wherein the VCO control signal sets an operating voltage for the delay-control transistor.

  
7. The apparatus of claim 6, wherein the delay-control transistor adjusts delay characteristics of delay elements in the VCO.

  
8. The apparatus of claim 7, wherein the delay-control transistor is configured to adjust an RC time-constant of at least one delay element.

  
9. The apparatus of claim 7, wherein the delay-control transistor is configured to adjust a current through the delay elements in the VCO.

  
10. The apparatus of claim 1, wherein the FLA circuit comprises:
a plurality of FLA sub-circuits, each FLA sub-circuit configured to receive (i) a respective phase of the plurality of phases of the local clock signal and (ii) the reference clock signal, and to output a partial FLA signal; and

each partial FLA signal provided as an analog signal to a summation node, the partial FLA signals responsively summed to generate the FLA signal.

  
11. The apparatus of claim 10, wherein each FLA sub-circuit is a first order sub-circuit, each sub-circuit comprising:
a first and a second D Flip-Flop arranged in a shift register configuration, the first and second D Flip-Flops configured to generate the latched values of the respective phase of the local clock signal according to adjacent edges of the reference clock signal; and
an XOR connected to the output of each D Flip-Flop, the XOR configured to receive the latched values, to responsively compare the latched values to determine if a transition occurred, and to responsively generate the partial FLA signal.


  
12. The apparatus of claim 10, wherein each FLA sub-circuit is a second order circuit, each sub-circuit comprising:
three D Flip-Flops arranged in a shift register configuration, a first and third D Flip-Flop configured to generate the latched values of the respective phase of the local clock signal according to edges of the reference clock signal that are separated by a unit interval; and
an XOR connected to the first and the third D Flip-Flop, the XOR configured to receive the latched values, to responsively compare the latched values to determine if a transition occurred, and to responsively generate the partial FLA signal.


  
13. The apparatus of claim 10, wherein the FLA circuit comprises 8 FLA sub-circuits, and the FLA signal has a range of values from −8 to +8.

  
14. A method comprising:
generating, using a voltage-controlled oscillator (VCO), a plurality of phases of a local clock signal;
receiving a phase of the local clock signal and a reference clock signal at a phase comparator and responsively generating and outputting a phase-error signal;
generating a frequency-lock assist (FLA) signal using a FLA circuit receiving one or more phases of the local clock signal and the reference clock signal, the FLA signal generated by detecting a number of phases of the two or more phases of the local signal having transitions of latched values, the FLA signal indicative of a magnitude of a frequency error between the reference clock signal and the local clock signal; and
generating a VCO control signal using an error accumulator circuit receiving the phase-error signal and the FLA signal, and responsively providing the VCO control signal to the VCO to lock the local clock signal to the reference clock signal.


  
15. The method of claim 14, wherein the error accumulator circuit is a loop filter.

  
16. The method of claim 15, further comprising receiving the phase-error signal at a second-order input of the loop filter and receiving the FLA signal at a first-order input of the loop filter.

  
17. The method of claim 16, wherein the loop filter is a resistor-capacitor (RC) filter, and wherein the second-order input is at a resistive input of the RC filter and the first-order input is at a capacitive input of the RC filter.

  
18. The method of claim 14, wherein the FLA signal sets the VCO in a frequency-lock condition, and subsequently the phase-error signal sets the VCO in a frequency and phase-locked condition.

  
19. The method of claim 14, wherein the VCO control signal sets an operating voltage for a delay-control transistor in the VCO.

  
20. The method of claim 19, further comprising adjusting the delay-control transistor to delay characteristics of delay elements in the VCO.

  
21. The method of claim 20, further comprising adjusting an RC time-constant of at least one delay element in the VCO.

  
22. The method of claim 20, further comprising adjusting current through at least one delay element in the VCO.

  
23. The method of claim 14, further comprising:
receiving, at a FLA sub-circuit of a plurality of FLA sub-circuits, a respective phase of the plurality of phases of the local clock signal and the reference clock signal, and responsively forming a partial FLA signal; and
receiving each partial FLA signal as an analog signal at a summation node and responsively generating the FLA signal by summing the received partial FLA signals from each FLA sub-circuit.


  
24. The method of claim 23, wherein each FLA sub-circuit is a first order sub-circuit, and generating each partial FLA circuit comprises:
latching values of the respective phase of the local clock signal according to adjacent edges of the reference clock signal; and
generating the partial FLA signal by comparing the latched values to detect if a transition of the latched values occurred.


  
25. The method of claim 23, wherein each FLA sub-circuit is a second order circuit, and generating each partial FLA circuit comprises:
latching values of the respective phase of the local clock signal according to edges of the reference clock signal that are separated by a unit interval; and generating the partial FLA signal by comparing the latched values to detect if a transition of the latched values occurred.


  
26. The method of claim 23, wherein the FLA circuit comprises 8 FLA sub-circuits, and the FLA signal has a range of values from −8 to +8.
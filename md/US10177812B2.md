Source: [US10177812B2](https://patents.google.com/patent/US10177812B2)

# [US10177812B2](US10177812B2.md) - Methods and systems for reduction of nearest-neighbor crosstalk

## Details

* Date: 2014-01-31
* Inventor: Kandou Labs SA
* Beneficiary: Amin Shokrollahi

## Other patents

### Backwards
 * US668687A
 * US780883A
 * US3196351A
 * US3636463A
 * US3939468A
 * US4163258A
 * US4181967A
 * US4206316A
 * US4276543A
 * US4414512A
 * US4486739A
 * [US4499550A](US4499550A.md)
 * US4722084A
 * US4772845A
 * US4774498A
 * US4864303A
 * US4897657A
 * [US4974211A](US4974211A.md)
 * US5017924A
 * US5053974A
 * US5150384A
 * [US5166956A](US5166956A.md)
 * US5168509A
 * US5266907A
 * US5283761A
 * US5287305A
 * US5311516A
 * US5331320A
 * [US5412689A](US5412689A.md)
 * US5449895A
 * US5459465A
 * US5461379A
 * US5511119A
 * US5510736A
 * US5553097A
 * US5566193A
 * US5599550A
 * US5626651A
 * US5629651A
 * US5659353A
 * US5727006A
 * US5748948A
 * US5802356A
 * [US5825808A](US5825808A.md)
 * US5856935A
 * US5875202A
 * US5945935A
 * US5949060A
 * US5982954A
 * US5995016A
 * [US6005895A](US6005895A.md)
 * [US6084883A](US6084883A.md)
 * US6119263A
 * US6172634B1
 * US6175230B1
 * US6232908B1
 * US20010006538A1
 * [US6278740B1](US6278740B1.md)
 * US6316987B1
 * US20010055344A1
 * US6346907B1
 * US20020034191A1
 * US20020044316A1
 * US6378073B1
 * US6384758B1
 * US20020057592A1
 * US6398359B1
 * US6404820B1
 * US6417737B1
 * US6424630B1
 * US6433800B1
 * [US6452420B1](US6452420B1.md)
 * US20020154633A1
 * US6473877B1
 * US20020163881A1
 * US20020167339A1
 * US6483828B1
 * US20020174373A1
 * US20020181607A1
 * US6509773B2
 * US20030016770A1
 * US20030016763A1
 * US6522699B1
 * US20030046618A1
 * [US6556628B1](US6556628B1.md)
 * US20030085763A1
 * US6563382B1
 * JP2003163612A
 * US20030146783A1
 * US6621427B2
 * US20030174023A1
 * US6624699B2
 * US20030185310A1
 * US6650638B1
 * US20030218558A1
 * [US6661355B2](US6661355B2.md)
 * US6664355B2
 * US6690739B1
 * US20040027185A1
 * [US6766342B2](US6766342B2.md)
 * US20040146117A1
 * US6772351B1
 * US20040155802A1
 * US20040161019A1
 * US20040170231A1
 * US20040169529A1
 * US6839587B2
 * [US6839429B1](US6839429B1.md)
 * WO2005002162A1
 * US6854030B2
 * US6865236B1
 * US6865234B1
 * US20050057379A1
 * US20050063493A1
 * US6876317B2
 * US20050134380A1
 * US20050149833A1
 * US6927709B2
 * US20050174841A1
 * US20050195000A1
 * US20050201491A1
 * CN1671092A
 * US20050213686A1
 * US20050220182A1
 * [US6954492B1](US6954492B1.md)
 * US6963622B2
 * US6973613B2
 * US20050270098A1
 * US6976194B2
 * [US6990138B2](US6990138B2.md)
 * US6993311B2
 * [US6999516B1](US6999516B1.md)
 * US20060036668A1
 * US7023817B2
 * US7039136B2
 * US20060097786A1
 * US20060103463A1
 * US7053802B2
 * US20060120486A1
 * US20060126751A1
 * US20060133538A1
 * US20060140324A1
 * US7072387B1
 * US7080288B2
 * US20060159005A1
 * US7082557B2
 * US7085153B2
 * US20060232461A1
 * US20060233291A1
 * US7127003B2
 * CN1864346A
 * [US7142612B2](US7142612B2.md)
 * US7142865B2
 * US20060267048A1
 * US20060291589A1
 * US20070001723A1
 * US20070002954A1
 * US7164631B2
 * US7167019B2
 * US20070030796A1
 * US7176823B2
 * [US7180949B2](US7180949B2.md)
 * US7199728B2
 * US20070076871A1
 * US20070103338A1
 * US20070121716A1
 * US7231558B2
 * US20070182487A1
 * US20070188367A1
 * US20070201597A1
 * US20070204205A1
 * US20070201546A1
 * US7269212B1
 * US7269130B2
 * US20070263711A1
 * US20070283210A1
 * US20080007367A1
 * US20080012598A1
 * US7336112B1
 * US7339990B2
 * US7346819B2
 * US7348989B2
 * US7356213B1
 * US7358869B1
 * US7362697B2
 * US7366942B2
 * US20080104374A1
 * EP1926267A1
 * [US7389333B2](US7389333B2.md)
 * US20080159448A1
 * US7397302B2
 * US7400276B1
 * US20080192621A1
 * US7462956B2
 * US20080317188A1
 * US7496162B2
 * US20090059782A1
 * US20090115523A1
 * US7535957B2
 * US7539532B2
 * US20090154604A1
 * CN101478286A
 * WO2009084121A1
 * US20090193159A1
 * US20090195281A1
 * US7583209B1
 * US7599390B2
 * US20090262876A1
 * US7613234B2
 * US20090275236A1
 * US7616075B2
 * [US7633850B2](US7633850B2.md)
 * US20090316730A1
 * US7639596B2
 * US20090323864A1
 * US7650525B1
 * US7656321B2
 * US20100046644A1
 * WO2010031824A1
 * US20100081451A1
 * US7694204B2
 * US7697915B2
 * US7698088B2
 * US7706456B2
 * US7706524B2
 * US20100148819A1
 * US20100177816A1
 * US20100180143A1
 * US7768312B2
 * US20100215087A1
 * US20100215112A1
 * US7787572B2
 * CN101820288A
 * US20100235673A1
 * US7804361B2
 * US7808456B2
 * CN101854223A
 * US20100271107A1
 * US20100283894A1
 * US20100296556A1
 * US20100309964A1
 * US20100329325A1
 * US7869546B2
 * US7869497B2
 * US20110014865A1
 * US7882413B2
 * US20110028089A1
 * US20110032977A1
 * US7899653B2
 * US20110051854A1
 * US20110072330A1
 * US20110074488A1
 * US20110084737A1
 * US7933770B2
 * US20110103508A1
 * US8000664B2
 * US20110228864A1
 * WO2011119359A2
 * US8030999B2
 * US8036300B2
 * US8050332B2
 * US20110268225A1
 * US8055095B2
 * US8064535B2
 * US20110286497A1
 * US20110302478A1
 * [US20110299555A1](US20110299555A1.md)
 * US20110317559A1
 * US8106806B2
 * US8149906B2
 * US20120082203A1
 * [US8159376B2](US8159376B2.md)
 * US8180931B2
 * US8185807B2
 * US20120133438A1
 * US8199849B2
 * US8199863B2
 * US20120152901A1
 * US20120161945A1
 * US20120163491A1
 * US8218670B2
 * US8233544B2
 * US8245094B2
 * US20120213299A1
 * US8253454B2
 * US8279745B2
 * US8279094B2
 * US20120257683A1
 * US8289914B2
 * US8295250B2
 * US8295336B2
 * US8310389B1
 * US8341492B2
 * US20130013870A1
 * US20130010892A1
 * US8359445B2
 * US8365035B2
 * EP2039221B1
 * US8406316B2
 * US20130088274A1
 * US8429495B2
 * US8429492B2
 * US20130106513A1
 * US8437440B1
 * US20130114663A1
 * US20130114519A1
 * US8443223B2
 * US8442099B1
 * US20130129019A1
 * US20130147553A1
 * US20130159584A1
 * US20130163126A1
 * US20130188656A1
 * US8498368B1
 * US20130195155A1
 * US20130202065A1
 * US20130215954A1
 * US8547272B2
 * US20130259113A1
 * US20130266047A1
 * US20130271194A1
 * US8578246B2
 * US8588254B2
 * US20130307614A1
 * US8593305B1
 * US20130315501A1
 * US20130314142A1
 * US8602643B2
 * US8604879B2
 * US20130346830A1
 * US8620166B2
 * US8643437B2
 * US8649460B2
 * US20140073196A1
 * US8674861B2
 * US8687968B2
 * US8718184B1
 * US20140127943A1
 * US8744012B1
 * US20140159769A1
 * US8755426B1
 * US20140177696A1
 * US8773964B2
 * US8782578B2
 * US8791735B1
 * US20140226455A1
 * US8831440B2
 * US20140254642A1
 * US20140266440A1
 * US20140269130A1
 * US8841936B2
 * US20140286381A1
 * US8879660B1
 * US8898504B2
 * US8938171B2
 * US20150049798A1
 * US8975948B2
 * US20150070201A1
 * US20150078479A1
 * US8989317B1
 * US20150117579A1
 * US9036764B1
 * US20150146771A1
 * US9059816B1
 * US9069995B1
 * US9077386B1
 * US9083576B1
 * US9100232B1
 * US20150236885A1
 * US9124557B2
 * US20150249559A1
 * US20150256326A1
 * US9148087B1
 * US9152495B2
 * US9172412B2
 * US9178503B2
 * US9183085B1
 * US20150333940A1
 * US9197470B2
 * US20150349835A1
 * US20150381232A1
 * US20150380087A1
 * US20160020796A1
 * US20160020824A1
 * US20160036616A1
 * US9281785B2
 * [US9288082B1](US9288082B1.md)
 * US9292716B2
 * US9300503B1
 * US9306621B2
 * US9331962B2
 * US9374250B1
 * US9432298B1
 * US20160261435A1
 * US9455744B2
 * US9479369B1
 * US9520883B2
 * US9634797B2
 * US20170310456A1
 * US20170317855A1
 * US20170317449A1
### Forward
 * 
## Abstract

Abstract

Methods and systems are described for reduction of crosstalk in multi-wire communications systems using ensemble codes. Constraints applied to code construction and/or permissible encoding sequences eliminate transmit patterns shown to generate capacitively coupled and/or inductively coupled crosstalk.



Methods and systems are described for reduction of crosstalk in multi-wire communications systems using ensemble codes. Constraints applied to code construction and/or permissible encoding sequences eliminate transmit patterns shown to generate capacitively coupled and/or inductively coupled crosstalk.

CROSS-REFERENCE TO RELATED APPLICATIONS
This application is a continuation of U.S. application Ser. No. 14/612,243, filed Feb. 2, 2015, entitled “Methods and Systems for Reduction of Nearest-Neighbor Crosstalk,” Naming Amin Shokrollahi, which claims priority to U.S. Provisional Application No. 61/934,508, filed Jan. 31, 2014, all of which are hereby incorporated herein by reference in their entirety for all purposes.
REFERENCES
The following are incorporated herein by reference: U.S. Pat. No. 8,442,099, Crosstalk cancellation for a common-mode channel, naming Hossein Sederat, issued May 14, 2013 [“Sederat”]; European Patent EP20392221 B1, Crosstalk cancellation using load impedance measurements, naming Michael Holmstrom, Sven Mattisson, and Bengt Edholm, issued Feb. 20, 2013 [“Holmstrom”]; U.S. Patent Application Publication No. 2008/0159448, System and method for crosstalk cancellation, naming Kofi Dankwa Anim-Appiah and Nirmal C. Warke. published Jul. 3, 2008 [“Dankwa”]; and U.S. Patent Application Publication No. 2012/0063291, CDMA-based crosstalk cancellation for on-chip global high-speed links, naming Tzu-Chien Hsueh and Sudhakar Pamarti, published Mar. 15, 2012 [“Hsueh”].
BACKGROUND OF THE INVENTION
One of the sources of error in communications links consisting of multiple wires (i.e., multi-wire communications links, or multi-wire communications systems more generally) is crosstalk between the wires. Crosstalk is the coupling of energy from one line to another when one wire transitions from one state to another. Such a transition can have an inductive or a capacitive crosstalk effect on the neighboring wires. Accordingly, the two forms of crosstalk are called inductive and capacitive crosstalk. Inductive crosstalk is caused by coupling of the magnetic fields of the wires, whereas capacitive crosstalk is caused by coupling of the electric fields.
Wires in a communication link are transmission lines, which may be modeled as distributed networks of series inductances and parallel capacitances. Inductive crosstalk as illustrated in FIG. 9A is caused by mutual inductance Lm between the distributed inductances of driven wire 950 and “victim” wire 960. A current through the driven conductor causes a current ILM in the opposite direction in the victim conductor. The strength of this current depends on the derivative of the transition change and the mutual inductance between the wires.
Capacitive crosstalk as illustrated in FIG. 9B is caused by mutual capacitance Cm between driven wire 950 and victim wire 960. Changes in the voltage between conductors results in a current ICM proportional to the rate of the change and the mutual capacitance between the conductors. Thus, the induction process induces a current that flows in the direction opposite to the direction of the original signal transition, while the capacitive process induces current that moves in both directions.
SUMMARY OF THE INVENTION
The total crosstalk caused on the victim line (or wire) at the near end is the sum of ICM and ILM. The total crosstalk caused on the victim at the far end is the difference ICM−ILM. On a Printed Circuit Board (PCB), the far-end crosstalk is typically negative, since the inductive current is typically larger than the capacitive current.
Disclosed herein are methods and systems incorporating—and of constructing—signaling schemes implementing codes that produce reduced crosstalk among parallel conductors of a communications interconnection. Unlike previously known crosstalk-reduction methods requiring modification of the analog transmit driver and/or analog receiver, the present methods and systems operate at the encoding/decoding level, simplifying the incorporation into existing designs.

BRIEF DESCRIPTION OF THE FIGURES
 FIG. 1 is a block diagram of a prior art communications system utilizing multiple communication wires to connect a transmitting integrated circuit chip 1 to a receiving integrated circuit chip 2.
 FIG. 2 is a block diagram of an embodiment incorporating Crosstalk Reduction (KXR) elements in transmitting chip 1 and receiving chip 2.
 FIG. 3 is a block diagram of a logic device performing a transformation of an incoming bit stream into an outgoing bit stream, optionally incorporating internal state.
 FIG. 4 is a circuit diagram of one example of a transformation.
 FIG. 5 is a graph for the largest subgraph with w=4.
 FIG. 6 is a graph for the proof that there is no (13,4)-KXR code.
 FIG. 7 illustrates eye diagrams for an example communications system with crosstalk.
 FIG. 8 illustrates eye diagrams for an example communications system with crosstalk and the described crosstalk cancellation.
 FIGS. 9A and 9B are models for crosstalk between wires as inductive and capacitive coupling components.
 FIG. 10 illustrates eye diagrams for a 5-wire embodiment without eliminating inductively bad patterns.
 FIG. 11 illustrates eye diagrams for a 5-wire embodiment eliminating inductively bad patterns.
 FIG. 12 illustrates eye diagrams for a 5-wire embodiment where only inductively bad patterns are used.

DETAILED DESCRIPTION OF THE INVENTION
Crosstalk can have very adverse effects on the integrity of signals transmitted at high speed on a multiconductor transmission line. An example is described in the context of a system in which a memory unit is connected to a processor via 8 parallel conductors laid out in close proximity to one another. The S-parameter matrix of the entire transmission line from pad to pad has been extracted using network analyzers. As one non-limiting example of a practical embodiment, signals are transmitted on these wires using a voltage source at 1.2 V. Signals are transmitted by keeping a common mode voltage of 0.6 V, and swinging around this common mode voltage with a swing of 150 mV in each direction. The voltage of 600+150 mV thus corresponds to a “1,” whereas the voltage of 600−150 mV corresponds to a “−1”. The detection of the signals is done via comparators on each wire that compare the value received against the common mode voltage of 0.6 V. The time period for which one simultaneously transmitted set of signals is sent is one ‘unit interval’ of transmission, with the eight wire values communicated in that unit interval generally representing one codeword of the communication. As will be understood by one familiar with the art, the number of wires in the communications channel may be different than the number of symbols in the code used over that channel, as in a subsequent example where 19 codewords are communicated over a channel in 20 consecutive unit intervals. Thus, for purposes of generality, the term “wire sequence” may be used to describe a codeword or portion of a codeword communicated over the wires of a communications channel.
The eye diagrams shown in FIG. 7 were produced by a software simulation of the example 8-wire communications system at a wire data rate of 8 Gbps using a statistical eye display application. The simulated communications system incorporates a 3-tap Transmit FIR, a Receiver CTLE, and a 1-tap DFE for signal equalization. The effects of SSO or reference noise have not been taken into account.
A completely different picture is obtained when the effect of crosstalk is cancelled out, as shown by the eye diagrams of FIG. 8. This is done in software by disregarding in the S-parameters the contribution of signals traversing between non-like ports. To obtain a fair comparison, the same equalization settings were used in the simulations of FIGS. 7 and 8.
Table 1 summarizes the horizontal and the vertical sizes of the eight eye diagrams shown in FIGS. 7 and 8, illustrating how dramatic the effect of crosstalk can be, as is well known to those of skill in the art.



 
 
 
 
 
 
 
TABLE 1
 
 
 
 
 
Eye width (psec)
 
Eye height (mV)
 
 
 
 
 
 
 
 
 
xtlk
No xtlk
xtlk
No xtlk
 
 
 
 
 
 
 
 
 
 
 
11.7
105.5
0
110.2
 
 
0
101.6
0
96.7
 
 
41
107.4
30.5
138.6
 
 
64.5
101.6
77.6
150
 
 
19.5
105.5
7.9
124.5
 
 
48.8
99.6
36.6
132.4
 
 
56.6
99.6
46.6
136.8
 
 
58.6
99.6
39.8
132.4
 
 
 
 











Because of its importance, crosstalk cancellation or reduction has been the subject of much investigation. One known method is to try to minimize the effect of crosstalk by careful layout of the wires in a multiconductor transmission line, e.g., by placing them further apart, or by introducing shielding between the wires. Where this is not sufficient, or such countermeasures are not possible due to lack of physical space, analog circuitry can be employed to reduce the effect of crosstalk. For example, Sederat describes analog components designed to reduce crosstalk between signals transmitted on differential lanes. Holstrom describes a method for crosstalk cancellation using load-impedance measurements (albeit for lower-speed signals). Other methods include the addition of the perturbation of a signal to the signals of the other wires, as described for example in the G.993.5 standard of the International Telecommunications Union. This method, called pre-coding, is done with analog circuitry embedded into the drivers of the transmission system. Dankwa describes yet another method of crosstalk cancellation in analog circuitry using a measurement of the channel response to estimate noise coefficients, and using these coefficients for cancelling crosstalk in neighboring wires. [Hsueh] uses CDMA techniques to overcome crosstalk in on-chip communications. Such techniques are used directly in the transmitter, which again requires analog circuitry to be added to that needed for the transmission of the data.
In general, most attempts to cancel or reduce crosstalk in a high-speed-communication system need to be employed directly in the analog circuitry needed for driving the signals on the wires of the multi-transmission line, and in several cases in the analog circuitry needed for detection as well. Many of these methods require training to learn the channel characteristics, as this is needed for optimal operation of these systems. As a result, many designers of high-speed-transmission lines, such as those designing the I/O of memory systems and subsystems, may decide not to use such crosstalk-cancellation circuitry for reasons of cost, delay, and lack of optimal characterization of the circuitry needed for a reproduction of the same in the billions, perhaps among other reasons. Moreover, in many cases, the driver and the receiver circuitry is used across multiple products, some of which may not require heavy or even any crosstalk cancellation. Adding a cancellation unit to such drivers may therefore unnecessarily increase the cost.
What is required is a very lightweight design that is capable of reducing the effect of crosstalk, that can be included with ease in existing product lines, and that can be turned off and on with ease depending on, e.g., what product line is in need of crosstalk cancellation. The present methods and systems provide such a design.
 FIG. 1 is a block diagram of a prior art chip-to-chip link. In this system, data is sent between two chips, called Chip 1 and Chip 2, via a set of communication wires. Chip 1 contains a Bit generator 110, which as one example might be a serializer connected to a wider host bus delivering bits, though the existence of a serializer is not required in this application. The bits are delivered to the Driver 120, which is typically implemented using analog circuitry. The Driver puts voltages/currents on the communication wires according to the bits it receives. Chip 2 has a Receiver 130, also typically implemented in analog, which infers the bits communicated on the communication wires by sensing said wires, and possibly performing additional tasks such as equalization, clock-and-data recovery, and more. The output of the Receiver is the Received digital bits 140.
 FIG. 2 is a block diagram of a chip-to-chip communication system according to at least one embodiment. In this example, another unit called KXR (Kandou Crosstalk Reducer) is added between the Bit generator and the Driver in Chip 1 as shown as 250, and after the Receiver in Chip 2 as shown as 260. The KXR in Chip 1 encodes the incoming digital data from the Bit generator and pass the new bits to the Driver. The operation of various embodiments of the KXR encoder is described later in this disclosure. The KXR in Chip 2 decodes the received bits back to their original form. In some embodiments, both of these units are implemented in digital logic, and there is no out-of-band communication between the KXR units and the analog parts of the corresponding chips, making adoption of the present methods and systems much simpler for vendors of systems that employ legacy chip-to-chip communication.
KXR Operation
The main function of KXR is reduction of inductive or capacitive crosstalk on the communication wires. This is done at least in part by reducing “nearest aggressor crosstalk”, i.e., crosstalk caused by the nearest neighboring wires. This is accomplished at least in part by disallowing certain transitions on the wires. Since this will reduce the number of possibilities of bits on the communication wires compared to the unrestricted case, KXR typically leads to some data-rate loss, which is discussed below. In the following examples, the label “(N,w)-KXR” refers to a KXR system receiving an integer between 0 and N-1, and outputting a w-dimensional bit vector wherein w is thus the number of communication wires. The input integer may be given to KXR from the Bit generator as a unique sequence of bits, such as a binary expansion of that integer.
As mentioned, in operation, KXR disallows certain transitions on the wires, thereby reducing the worst-case crosstalk effect caused by the nearest aggressors. When considering inductive crosstalk, worst-case crosstalk on a victim wire is obtained when that wire is high, or is pulling high, while its two neighboring wires also pull high. Similarly, the wire could be low, or could pull low, while its two neighboring wires also pull low. This is because a wire pulling high causes a negative voltage on its neighboring wires. Two wires pulling high cause twice the negative voltage on the middle wire, and if the final value of the middle wire is high, then the negative voltage will cause a degradation of the signal quality.
Similarly, in the case of capacitive crosstalk, the worst case is obtained when a wire is pulling high (low), or remains high (low), while its two neighboring wires pull low (high). Based on these observations, we call any of the transitions
    111→000, 101→000, 000→111, 010→111

on three consecutive wires “inductively bad” and any of the transitions
 111→010, 101→010, 000→101, 010→101

on three consecutive wires “capacitively bad”. KXR avoids (inductively or capacitively) bad transitions on any set of three consecutive wires.
   
The KXR unit is shown in the block diagram of FIG. 3. It comprises a logic element (an encoder or a decoder), and a possible STATE set consisting of flip-flops that store state information from one transmission to the next. The encoder determines the outgoing bits based on the incoming bits and the information provided by the stored states. The KXR unit may also comprise another switch that changes the behavior of the unit depending on whether inductive or capacitive crosstalk is to be reduced.
Various embodiments of the KXR unit will now be described and simulation results presented that show the positive effect of KXR on crosstalk reduction.
Stateless Encoding
The first described set of embodiments of KXR units have no state information. In these embodiments, no additional controls need to be provided to the KXR unit to reset state bits after periods of inactivity of the link. (The alternative would be to memorize the latest state, which would lead to unnecessary power consumption).
In a stateless encoder, the result of the encoding needs to be a vector that does not contain 111 or 000 as a consecutive substring (in case of inductive crosstalk), or that does not contain 101 or 010 (in case of capacitive crosstalk). To illustrate, note that in the case of inductive crosstalk, the target of any bad transition is either a string 111 or a string 000 on three consecutive wires; avoiding these will therefore ensure that there are no bad transitions. On the other hand, if for example 111 is the result of a transition on three consecutive wires, it is possible to have had a 010 just prior to that transition, which means that a worst-case nearest-neighbor inductive crosstalk event has taken place. Not having a 111 (and a 000) subsequence is therefore necessary and sufficient for a stateless KXR encoder to function properly when worst-case inductive crosstalk events are to be avoided. A similar reasoning is valid for the case of capacitive crosstalk.
EXAMPLE 1
3 Wires
An embodiment of an encoder and a decoder are now described for a stateless (6,3)-KXR. In this case, the output of the KXR unit can only be one of the following vectors:
    (1,1,0), (1,0,1), (1,0,0), (0,0,1). (0,1,0), (0,1,1).   
Given an integer N between 0 and 5 represented as a sequence of bits (a,b,c) with a&b=0 (so, the integer is for example 4a+2b+c), the following may be performed:
    PROCEDURE SL-ENC3 (Stateless encoder on 3 wires): Output the bit-sequence (a⊕(b&c)), b⊕c, c where & is the logical AND operation, ⊕ is the XOR operation, and c is the complement of the bit c.   
It can be seen that this encoding ensures that no two different 3-bit inputs will produce the same output bit-sequence. Many other forms of encoding are possible as well, for example one giving the bits a, b, c&(a⊕b)|NOR(a,b) where | is the logical OR, and NOR is the NOR function (Not-OR).
    The decoder is given as: PROCEDURE SL-DEC3 (Stateless decoder on 3 wires): Given three bits x,y,z, the decoder outputs the bits x ⊕ NOR(y, z), y ⊕ z, z.   
In the second case, the output bits are x, y, z&(x⊕y)|NOR(x,y).
As an example of a specific embodiment, FIG. 4 shows a logic diagram for the encoder and the decoder in the first case, where a, b, c are the input value, x, y, z are the output bits of the encoder, and the output of the decoder are recovered a, recovered b, recovered c.
One familiar with the art will be well aware of numerous methods to map input values using a mapper as shown in FIG. 3 to generate a constrained range as represented by N above, including use of modulus arithmetic, mapping table, etc. which may be applied in combination with the present invention. In one such example, a block conversion from a base 2 modulus to base 6 modulus is used to change the modulus of the number. In a 3-wire example, the modulus encoder receives 5 bits (32 combinations possible) and outputs two sets of three bits (having 36 total possible combinations is 36), each set of three bits being a binary value of an integer in the range 0-5.
In some embodiments, a method comprises: receiving a set of input data bits; generating a plurality of sets of modulus-converted data bits; selecting a cross-talk reduction codeword vector from a set of crosstalk reduction codeword vectors, wherein each of the crosstalk reduction codeword vectors eliminates patterns of adjacent vector elements associated with either an inductive or capacitive constructive interference; and transmitting the selected crosstalk reduction codeword vector on a multi-wire system. The method may also utilize a set of three wires including a first wire, second wire, and third wire, and the inductive constructive interference comprises transitions where signal levels on the first wire and third wire transition to the same signal level of the second wire, and capacitive constructive interference comprises signal levels on the first wire and third wire transition to an opposite signal level of the second wire. The method may utilize a system wherein the recovered encoded set of data is output from the multi-wire system. The encoding may be performed in a stateless manner, where each crosstalk reduction codeword vector selected based only on the sets of modulus-converted data bits to be encoded. Alternatively, the encoding may be performed in a stateful manner, each crosstalk reduction codeword vector selected based on both the sets of modulus converted data bits to be encoded and at least one previous operation of the encoder.
A further embodiment may include a system comprising: a plurality of signal conductors for receiving a set of input data; a bit generator connected to the signal conductors to receive the input data and form a set of modulus converted data bits; a logic encoding circuit connected to the bit generator used to form a set of crosstalk reduction codeword vectors based at least in part on the set of modulus converted data bits, wherein each crosstalk reduction codeword vector in the set of crosstalk reduction codeword vectors eliminates patterns of adjacent vector elements associated with either an inductive or capacitive constructive interference; and a transmit driver emitting crosstalk reduction codewords onto a multi-wire transmission bus. The system may further comprising a logic decoding receiver to decode the crosstalk reduction codeword vectors received from the multi-wire transmission bus to recover the sets of modulus converted data bits. The system may utilize a multi-wire transmission bus containing at least 3 wires. The set of crosstalk reduction codeword vectors is based on the modulus converted data bits and at least one of a previous encoding and previous modulus converted data bit.
EXAMPLE 2
4 Wires
An embodiment of an encoder and a decoder are now described for a stateless (10,4)-KXR. In this case, the output of the KXR unit can only be one of the following 5 vectors or their complements:
    (1,1,0,1), (1,0,1,1), (1,0,0,1), (1,1,0,0), (1,0,1,0).   
The following algorithm takes care of the encoding: given 4 bits a, b, c, d corresponding to an integer A between 0 and 9 with a being the most significant bit, the following steps are performed:
    PROCEDURE SL-ENC4: IF (A<4) THEN
         Output (c, c, c, d) 
 ELSE
         Output (d, d, b⊕(d&c), d⊕c). 
   
One implementation of a comparable KXR decoder could perform the following procedure: Given bits x, y, z, u coming out of the receiver, the following steps are performed:
    PROCEDURE SL-DEC4: IF (x=y) THEN
         Output (0,0,x,u) 
 ELSE
         Output ((z⊕(x&(u)), (z⊕(x&(u)), x⊕u, x). 
   
Note that in the first case, error checking could be performed since in this case z must be x).
    EXAMPLE 3
5 Wires
An encoder and a decoder are now described for a stateless (16,5)-KXR. In this case, the output of the KXR unit can only be one of the following eight vectors or their complements:
    (1,1,0,1,1), (1,1,0,1,0), (1,1,0,0,1), (1,0,1,1,0), (1,0,1,0,1), (1,0,0,1,1), (1,0,1,0,0), (1,0,0,1,0)   
The following algorithm takes care of the encoding: given 4 bits a, b, c, d corresponding to an integer A between 0 and 15, with a being the most significant bit, the following steps are performed:
    PROCEDURE SL-ENC5: IF (A<10) THEN
         Apply SL-ENC4 to (a,b,c,d) and denote output by (x,y,u,z). Output (x, x,y,u,z). 
 ELSE
         Set A:=A-10 Apply SL-ENC3 to N and denote the output by (y, u, z). Output (y, y, y, u, z). 
   
The decoder could implement the following algorithm for input bits x, y, u, z, v:
    PROCEDURE SL-DEC5: IF (x=y) THEN
         Apply SL-DEC3 to (u,z,v). If the output is (a,b,c), then output the binary expansion of 10+4a+2b+c. 
 ELSE
         Apply SL-DEC4 to (y,u,z,v) and return its output. 
   
A simulation was performed using an example channel consisting of 5 wires, using communications channel characteristics similar those of the 8-wire case described above. FIG. 10 shows statistical simulations of the eye diagrams of the 5 wires when using single-ended signaling without eliminating the inductively bad patterns. As can be seen, the first two eyes are quite closed. Eliminating the inductively bad patterns yields the eye diagrams of FIG. 11, which are more open. Simulations were also performed using only inductively bad patterns, which are shown in FIG. 12.
Table 2 summarizes the results for both single-ended signaling without eliminating the inductively bad patterns, signaling using only inductively bad patterns, and signaling using KXR to eliminate the inductively bad patterns.



 
 
 
TABLE 2
 
 
 
Eye width (psec)
Eye height (mV)
 
 
 
 
 
 
 
 
 
Inductively
 
 
Inductively
 
 
SE
bad patterns
KXR
SE
bad patterns
KXR
 
 
 
 
 
 
 
 
 
 
35.2
33.2
68.4
0.0
0.0
40.1
 
0.0
0.0
50.8
0.0
0.0
14.7
 
48.8
66.4
64.5
55.7
99.5
79.4
 
84.0
85.9
91.8
109.6
117.2
129.2
 
60.5
58.6
74.2
76.2
73.7
115.7
 
 
 











As can be seen, the effect of KXR is quite dramatic. The middle columns of Table 2 show that the main reason for the bad behavior of single-ended signaling are the inductively bad patterns.
In the general case of w wires, it can be seen that the number of codewords not containing inductively bad patterns is 2×Fw where Fw is the w-th Fibonacci number: F1=1, F2=2, F3=F2+F1=3, F4=F3+F2=5, F5=F4+F3=8, etc.
Very similar relationships hold for codes not containing capacitively bad patterns.
In the case of 5 wires, 4 bits can be sent. In general, since the state space is being limited, it is not possible to send at full rate. The present methods and systems are useful in, among other scenarios, cases where there are additional wires present and dedicated to other tasks. One such example, discussed below, is the “mask bit” used for memory interfaces.
Coding with States
Coding schemes that memorize states from one transition to another are utilized in order to further increase the rate of the transmission. The second disclosed set of embodiments of KXR units incorporate some state information that gets updated from one transition to another. In these embodiments, the operation of the KXR unit is slightly more complex. Moreover, further control is used to reset the state information during periods of inactivity of the link. This is described below in the context of memory links, without the need of a direct communication between KXR and the analog receiver/transmitter.
STATEFUL EXAMPLE 1
3 Wires
In this description of this embodiment, it is assumed that the state of the wires at the previous time instance is (x,y,z) and that the incoming bits are (a,b,c) corresponding to an integer A between 0 and 6, with a being the most significant bit (so a&b&c=0). In this case, the encoding uses one bit of memory, called m, which is the logical ‘AND’ of the values on the first and the third wire:



 
 
 
 
SF-ENC3: Stateful encoding on 3 wires:
 
 
 
 
 
 
 
 
 
Output (a⊕m, b⊕m, c⊕m)
 
 
Update m to a⊕m
 
 
 
 









To see that this encoding indeed does not cause worst case inductive crosstalk on the middle wire, note that m=x. Such crosstalk is caused only if a⊕x=x, c⊕x=z=x, and b⊕x=x. This means that a=b=c=1. But by assumption we cannot have a=b=c=1 since a&b&c=0.
    The decoder's operation is similar to that of the encoder. The decoder receives bits x, y, z on the three wires, and additionally has a bit m which is the logical and of the bits on the first and the third wire at the previous round:



 
 
 
 
SF-DEC3: Stateful decoding on 3 wires
 
 
 
 
 
 
 
 
 
Output (x⊕m, y⊕m, z⊕m)
 
 
Update m to x⊕m.
 
 
 
 









The case of capacitive crosstalk can also be handled in a similar manner.
STATEFUL EXAMPLE 2
4 Wires
In this embodiment, the state that is remembered is two bits only, called x and v. These two bits are equal to the bits on wires 1 and 4, respectively, sent in the previous round.
At any given time, given 4 bits (a,b,c,d) representing an integer A between 0 and 11, and a being the most significant bit (hence a&b=0), and given the prior states m1, m2, a new set of 4 bits is computed, and the states m1, m2 are updated. The encoding algorithm is as follows:



 
 
 
 
SF-ENC4: Stateful encoding on 4 wires
 
 
 
 
 
 
 
 
 
IF ( A = 10 ) THEN
 
 
 
 
 
Output (x,x,x,   x).
 
 
m2 :=   x. EXIT.
 
 
 
 
 
IF ( A=11 ) THEN
 
 
 
 
 
Output (   v,v,v,v).
 
 
m1 :=   v. EXIT.
 
 
 
 
 
IF ( A < 4 ) THEN
 
 
 
 
 
Output (c, c,   c, d).
 
 
m1 := c, m2 := d.
 
 
 
 
 
ELSE
 
 
 
 
 
Output (d,   d,   b⊕(d&c), d⊕c).
 
 
m1 := d, m2 := d⊕c.
 
 
 
 























The decoder essentially performs these operations in reverse, though it does not need additional states. Given incoming bits (s0, s1, s2, s3), the decoder performs the following steps:



 
 
 
 
SF-DEC4: Stateful decoding on 4 wires
 
 
 
 
 
 
 
 
 
IF ( s0 = s1 and s1=s2 ) THEN
 
 
 
 
 
Output (1,0,1,0). EXIT.
 
 
 
 
 
IF (s1=s2 and s2=s3) THEN
 
 
 
 
 
OUTPUT (1,0,1,1). EXIT.
 
 
 
 
 
IF (s0 = s1) THEN
 
 
 
 
 
Output (0,0, s0, s3). EXIT.
 
 
 
 
 
ELSE
 
 
Output ((z⊕(x&(   u)),   (z⊕(x&(   u)) , x⊕u, x)
 
 
 
 





















The case of capacitive crosstalk can also be handled in a similar manner.
STATEFUL EXAMPLE 3
5 Wires
In this description of this embodiment, it is assumed that the state of the wires at the previous time instance is (x,y,z,u,v) and that the incoming bits are (a,b,c,d,e). This sequence is interpreted as the binary expansion of an integer, called A, between 0 and 21 (with a representing the most significant bit of that integer). Four bits of memory are used: m0, m1, m2, m3, m4. In operation, m0 corresponds to state x of the first wire in the previous transmission, m1 corresponds to state z of the third wire in the previous transmission, m2 corresponds to the state v of the fifth wire in the previous transmission, and m3 is y, and m4=1 if and only if in the previous transmission it is the case that y=u=x.
A sequence S of 19 vectors is maintained, the vectors being potential successor states for the wire states, no matter what the previous states are. This sequence is given below:
    S[0]=[0,0,1,0], S[1]=[1, 0, 1, 0, 0], S[2]=[0, 1, 1, 0, 0], S[3]=[1, 0, 0, 1, 0], S[4]=[1, 1, 0, 1, 0], S[5]=[0, 0, 1, 1, 0], S[6]=[1, 0, 1, 1, 0], S[7]=[0, 1, 0, 0, 1], S[8]=[1, 1, 0, 0, 1], S[9]=[0, 0, 1, 0, 1], S[10]=[0, 1, 1, 0, 1], S[11]=[1, 0, 0, 1, 1], S[12]=[0, 1, 0, 1, 1], S[13]=[1, 1, 0, 1, 1], S[14]=[m0, m0,m0,m0], S[15]=[m0, m0, m0, m0, m0], S[16]=[  m 2, m2, m2, m2, m2], S[17]=[m2, m2, m2, m2, m2], S[18]=[m3, m3, m3, m3,m3].   
The exact ordering of this set is only relevant to the efficiency of any procedure that maps integers between 0 and 18 to the specific elements of this sequence. This sequence has the properties that (a) it does not contain a sequence of the form (u,u, u,u, u), where u is 0 or 1 (it can be seen that such sequence would not allow for 22 successor states that are all inductively good) and (b) all of these successor states are inductively good for the previous state (x,y,z,u,v) of the wires. The extension of this set by three more elements is shown below. These elements depend on the relationship between the memory bits.
    If m0=m1=m2, then set S[19]=[m0, m0, m0, m0,m0], S[20]=[m0, m0, m0, m0, m0], S[21]=[m0, m0, m0, m0, m0]. If m0=m1≠m2, and m4=1, then set S[19]=[m2, m2,m2,m2,m2], S[20]=[m2, m2, m2,m2,m2], S[21]=[m0, m0, m0, m0, m0]. If m0=m1≠m2, and m4=0, then set S[19]=[m2, m2,m2,m2, m2], S[20]=[m2, m2, m2, m2, m2], S[21]=[m0, m0, m0, m0, m0]. If m0≠m1, and m4=1, then set S[19]=[m0, m0, m0, m0, m0], S[20]=[m0, m0, m0, m0,m0], S[21]=[m0, m0, m0, m0,m0]. If m0≠m1, and m4=0, then set S[19]=[m0,m0,m0, m0, m0], S[20] =[m0,m0,m0, m0,m0], S[21]=[m0,m0,m0,m0, m0].   
With these preparations, the encoding procedure can be stated as follows:
    SF-ENC5: Stateful encoding on 5 wires   
Given integer A, and previous states m0-m4, select the vector S[A] as the next state. Set m0to S[A][1], m1 to S[A][3], m3 to S[A][5], m4 to S[A][2], and m4 to 1 if and only if m4=S[A][4]=m0.
The decoding procedure is the following. In this form it requires only one previous state:
    SF-DEC5: Stateful decoding on 5 wires   
Given a bit sequence (x,y,z,u,v) and one previous state m, do the following:
    a. Determine the longest run r of equal values in the vector. b. If r<3, then determine an index A from 0 to 13 such that S[A] is the given bit sequence. Output A and go to Step e. c. If r=3, then i. If m=1, then determine index A between 14 and 18 such that S[A] is the given bit sequence. Output A and go to Step e. ii. If not, then determine index A between 14 and 20 such that S[A] is the given bit sequence. Output A and go to Step e. d. If r=4 or r=5, then i. If m=1, then determine index A between 19 and 21 such that S[A] is the given bit sequence. Output A and go to Step e. ii. If not, output A=21. e. Update m: if x=z=v, then set m=1, else set m=0. EXIT.

A Procedure to Determine Whether a (N,w)-KXR Exists
   
One of the questions that arise in the design of crosstalk-reducing codes is: what is the largest number N of states that can be encoded when w wires are available? In other words, what is the largest number N for which an (N, w)-KXR exists? The examples above show that N≤7 if w=3, N≤12 if w=4, and N≤22 if w=5. A priori, it is not clear that these bounds are sharp, i.e., that it is not possible to achieve larger values of N for the given number of wires.
A procedure that finds the maximum value of N for a given value w is outlined below. This procedure is described using the language of directed graphs; as known to those of skill in the art, a directed graph is a structure consisting of a finite set of “nodes” and a finite set of pairs (x,y) where x and y are nodes. Such a pair is often interpreted as an “arrow” between x and y. The “outdegree” of a node is the number of arrows leading out of the node, and the “indegree” of a node is the number of arrows leading into the node.
Given the number w of wires, the graph G that is of interest in this context has as its set of nodes the 2w vectors in the set {0,1}w, i.e., the set of all binary vectors of length w. These are potentially the values that can be sent on the w wires. In this procedure, an arrow is placed between a vector x and a vector y if y is a valid successor for x, i.e., if a transition from x to y does not lead to worst-case inductive (or capacitive) crosstalk on any of the wires. Once G is constructed, the number N will be the size of the largest subgraph of G for which every node has outdegree N. The nodes that are not in this subgraph are states that the wires will never be in, when using this type of coding.
To find whether this largest subgraph has a size of at least n, for a given n, the following steps are carried out: all of the nodes that have outdegree that is strictly smaller than n are deleted from G; this is done until either the graph has fewer than n elements or until all of the remaining nodes in the graph have outdegree at least n; if the first of those two cases occurs, it is concluded that the required subgraph has fewer than n nodes; if instead the second of those two cases occurs, it is concluded that the required subgraph has at least n nodes (and indeed such a subgraph has thereby been identified).
To find the largest subgraph, a search is conducted for N using a binary search and the above method. Once N is found, a largest subgraph has also been found.
An example in which w=4 is now briefly considered. The graph G corresponding to this case is shown in FIG. 5, where symbolic names 1, 2 , . . . , 16 have been assigned to the nodes of the graph, and where every node is also labeled with the vector corresponding to that node. As examples, the node 1 corresponds to the vector (0000) and the node 11 corresponds to (1010). Also, to simplify the figure somewhat, the self-loops—i.e., transitions from a vector to itself—have been omitted. This is for clarity of presentation and not by way of limitation.
The list of neighbors of every node and the outdegree of the node are given in Table 3.



 
 
 
 
TABLE 3
 
 
 
Node
Neighbors
Outdegree
 
 
 
 
 
 
 
 
 
1
[1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14]
13
 
2
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
14
 
3
[1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15]
14
 
4
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
16
 
5
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
14
 
6
[2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14]
12
 
7
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
16
 
8
[2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16]
14
 
9
[1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15]
14
 
10
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
16
 
11
[3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15]
12
 
12
[3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
14
 
13
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
16
 
14
[2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16]
14
 
15
[3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
14
 
16
[3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16]
13
 
 
 









It is now demonstrated that there is no (13,4)-KXR code. To demonstrate this, it is initially assumed that there is an (N,4)-KXR code where N>12. Making this assumption results in removal of nodes 6 and 11 from the graph, since they each have a degree less than 13. The resulting graph is shown in FIG. 6, and the list of neighbors in this new graph as well as the new outdegrees is given in Table 4.



 
 
 
 
TABLE 4
 
 
 
Node
Neighbors
Outdegree
 
 
 
 
 
 
 
 
 
1
[1, 2, 3, 4, 5, 7, 9, 10, 12, 13, 14]
11
 
2
[1, 2, 3, 4, 5, 7, 8, 9, 10, 12, 13, 14]
12
 
3
[1, 2, 3, 4, 5, 7, 9, 10, 12, 13, 14, 15]
12
 
4
[1, 2, 3, 4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 16]
14
 
5
[1, 2, 3, 4, 5, 7, 8, 9, 10, 12, 13, 14]
12
 
6
[2, 3, 4, 5, 7, 8, 10, 12, 13, 14]
10
 
7
[1, 2, 3, 4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 16]
14
 
8
[2, 3, 4, 5, 7, 8, 10, 12, 13, 14, 15, 16]
12
 
9
[1, 2, 3, 4, 5, 7, 9, 10, 12, 13, 14, 15]
12
 
10
[1, 2, 3, 4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 16]
14
 
11
[3, 4, 5, 7, 9, 10, 12, 13, 14, 15]
10
 
12
[3, 4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 16]
12
 
13
[1, 2, 3, 4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 16]
14
 
14
[2, 3, 4, 5, 7, 8, 10, 12, 13, 14, 15, 16]
12
 
15
[3, 4, 5, 7, 8, 9, 10, 12, 13, 14, 15, 16]
12
 
16
[3, 4, 5, 7, 8, 10, 12, 13, 14, 15, 16]
11
 
 
 









It can be seen at this point in this demonstration that the number of nodes of outdegree at least 13 is less than 13, which means that a (13,4)-KXR cannot exist.
Table 5 lists, for values of w between 3 and 9, the largest N such that an (N, w)-KXR exists.
                         TABLE 5           w 3 4 5 6 7 8 9           N 7 12 22 40 72 136 248               
Memory Interfaces

KXR coding typically requires more data wires than the number of transmitted data bits, since it restricts the state space of the wire values in every transmission. Normally, this would mean that the data would have to be sent using a faster clock rate in order to achieve the same throughput as without KXR coding. Whether this can be done is application-dependent. There are, however, some applications in which the total number of wires carrying main and additional data is already larger than the actual number of bits transmitted. KXR coding may be particularly interesting for such applications, one of which relates to memory interfaces and is described below.
In a typical memory interface, as found in various flavors of DDR, data transmission is organized in groups of 9 wires and data is transmitted in a single-ended manner on the 9 wires. These wires transmit altogether one byte of data in every transmission, plus one “mask bit.” Typically, if the mask bit is detected on the 9th wire, the controller (or the memory) disregards the data transmitted on the data wires.
A different way of transmitting the data as an ensemble—that is known to those of skill in the art—is to identify at least 257 states on the 9 wires, map 256 of those to 8 bits of data, and the 257th state to the mask. Whenever the 257th state is encountered, the data represented by the 9 wires in that ensemble transmission is disregarded.
As can be seen from the results of the last section, it is not possible to construct a (257,9)-KXR, a code that would be needed to reduce nearest neighbor crosstalk in memory systems. Discussed below are two options for addressing this.
In the first variant, a (248,9)-KXR is used and the clock rate is increased by about 5% to effectively send 1 out of 257 possibilities per transmission. More precisely, 19 such combinations of data+mask can be mapped to 20 channel uses of a code with 248 states. These 19 combinations are collected and mapped to the 20 codewords of the (248,9)-KXR. These codewords are sent over the 9 wires in 20 intervals and decoded. The decoded codewords enter a buffer on the receiving side, and as soon as 20 of them are collected, they are decoded to the 19 combinations of data+mask.
Another option is to use a stateless (130,9)-KXR, which is capable of sending slightly more than 7 bits over the 9-wire channel. A sequence of length 7 consisting of data+mask bits (each coming from 257 states) can be mapped to 8 codewords of this (130,9)-KXR. These can be sent across the channel and decoded by the receiver to recover the original sequence of 7 words.
This option has the advantage that it results in lower worst-case nearest-neighbor crosstalk for all the wires in the interface, provided that the 9-wire interface is sufficiently separated from other 9-wire interfaces so as to minimize crosstalk from wires in the adjacent interfaces. It has possible disadvantages as well: it may create a higher latency, and the clock needs to run slightly faster (by a factor of 20/19˜1.053 in the first case and by a factor of 8/7˜1.143 in the second case), which means that the addition of KXR may not be completely transparent to the rest of the communication system.
Another option results in halving worst-case nearest-neighbor inductive or capacitive crosstalk on all but two of the wires in the interface. This code uses a combination of a (22,5)-KXR and a (12,4)-KXR. The encoder operates as follows:
    It receives an integer A between 0 and 256. It calculates integers A1 and A2 such that A=22*A1+A2, and 0≤A2<22 (so that 0≤A1<12). It uses SF-ENC5 on A2 to create the wire values x0, . . . , x4 on the first five wires, and it uses SF-ENC4 on A1 to create the wire values x5, . . . , x8 on the last four wires.   
The decoder operates as follows:
    It receives the wire values x0, . . . , x8. It uses SF-DEC5 on the values x0, . . . , x4 to obtain a value A1 between 0 and 21, and it uses SF-DEC4 on the values x5, . . . , x8 to obtain a value A2 between 0 and 11. It calculates A=22*A1+A2. If A>255, then it deduces that the mask bit is active and sends the value of an active mask bit to the controller or memory. If not, then it sends the 8 bits representing A to the controller or memory.   
While the effect of the worst case nearest neighbor crosstalk is halved on wires 2, 3, 4, 7, 8, wires 5 and 6 may still experience such crosstalk. This is because the encoders SF-ENC5 and SF-ENC4 are not correlated, and depending on the switching activities of the last two wires within the group of the first five wires and the switching activities of the first two wires within the group of the last four wires, one could have worst-case crosstalk on these two wires.
In some embodiments, a method of reducing crosstalk in a multi-wire communications system is described in which data is transmitted on multiple wires according to transmission unit intervals. The method comprises: identifying wire sequences that (i) span consecutive transmission unit intervals and (ii) induce at least one of capacitive crosstalk and inductive crosstalk between the multiple wires; encoding communications data as consecutive ensembles to be transmitted on the multiple wires such that none of the identified wire sequences will occur on any of the multiple wires; and transmitting the encoded communications data on the multiple wires of the multi-wire communications system.
Further embodiments include a system for reducing crosstalk in multi-wire communications systems, the system comprising: an encoding of input data as ensembles of symbols; a communications interconnection comprised of multiple elements each configured to communicate one or more symbols of the encoded data; a transmit driver emitting symbols of encoded data onto the multiple elements of the communications interconnection in a transmit interval; a crosstalk analysis comprised of a ranking by crosstalk amount of transmitted symbol sequences on two or more adjacent elements of the communications interconnection occurring in consecutive transmit intervals; wherein the encoding is constrained to avoid symbol sequences ranking above a predetermined limit by the crosstalk analysis.
The embodiments presented herein illustrate the use of ensemble codes for point-to-point wire communications. However, this should not be interpreted as limiting the scope of the present methods and systems, which are equally applicable to other interconnection topologies, expressly including bussed and multi-drop interconnections using unidirectional and bidirectional communications protocols, as well as other known encoding methods and communications media including but not limited to optical and wireless. Thus, descriptive terms such as “voltage” or “signal level” should be considered to include both electrical equivalents such as “current”, and also equivalents in other measurement systems, such as “optical intensity,” “RF modulation,” etc. Similarly, specific examples provided herein are for purposes of description, and do not imply a limitation.

I claim:
 
1. A method comprising:
obtaining a set of n bits representing a first integer A and responsively partitioning the set of n bits into a first subset of bits and a second subset of bits, wherein 0≤A<2n;
encoding the first and second subsets of bits into bits of a first codeword of a first crosstalk-reduction (XR) code and into bits of a second codeword of a second XR code, respectively, the codewords of the first and second XR codes eliminating patterns of adjacent vector elements associated with either an inductive or capacitive constructive interference; and
transmitting the bits of the first and second codewords via adjacent groups of wires of a multi-wire bus having at least n+1 wires, the adjacent groups of wires having w1 and w2 wires, respectively.


  
2. The method of claim 1, wherein the first XR code comprises N1 available codewords having w1 elements, and wherein the second XR code comprises N2 available codewords having w2 elements, wherein N1<2w1, N2<2w2, and wherein N1>N2 and w1>w2.

  
3. The method of claim 2, wherein 2n<N1*N2<2n+1.

  
4. The method of claim 3, wherein partitioning the n bits comprises identifying first and second states A1 and A2 based on the first integer A, wherein A=N1*A1+A2, and wherein 0≤A2<N1.

  
5. The method of claim 4, wherein the first subset of bits is a bit representation of state A1 and wherein the second subset of bits is a bit representation of state A2.

  
6. The method of claim 3, wherein N1=22, w1=5, N2=12, and w2=4, and wherein n=8 bits.

  
7. The method of claim 1, wherein the set of n bits further comprises an n+1′th mask bit, and wherein 0≤A≤2n.

  
8. The method of claim 1, wherein encoding the first and second subsets of bits comprises stateful encoding.

  
9. The method of claim 1, further comprising
receiving a third and a fourth codeword of the first and second XR codes via w1 and 2 wires of the multi-wire bus, respectively; and
determining a set of n output bits based on the received third and fourth codewords.


  
10. The method of claim 9, further comprising generating state representations of the third and fourth codewords, and forming a second integer based on the state representations of the third and fourth codewords, and responsively generating the set of n output bits representative of the second integer.

  
11. An apparatus comprising:
a plurality of signal conductors configured to obtain a set of n bits representing a first integer A and responsively partitioning the set of n bits into a first subset of bits and a second subset of bits, wherein 0≤A<2n;
an encoder configured to encode the first and second subsets of bits into bits of a first codeword of a first crosstalk-reduction (XR) code and into bits of a second codeword of a second XR code, respectively, the codewords of the first and second XR codes eliminating patterns of adjacent vector elements associated with either an inductive or capacitive constructive interference; and
a plurality of drivers configured to transmit the bits of the first and second codewords via adjacent groups of wires of a multi-wire bus having at least n+1 wires, the adjacent groups of wires having w1 and w2 wires, respectively.


  
12. The apparatus of claim 11, wherein the first XR code comprises N1 available codewords having w1 elements, and wherein the second XR code comprises N2 available codewords having w2 elements, wherein N1<2w1, N2<2w2, and wherein N1>N2 and w1>w2.

  
13. The apparatus of claim 12, wherein 2n<N1*N2<2n+1.

  
14. The apparatus of claim 13, wherein the encoder is configured to partition the n bits by identifying first and second states A1 and A2 based on the first integer A, wherein A=N1*A1+A2, and wherein 0≤A2<N1.

  
15. The apparatus of claim 14, wherein the first subset of bits is a bit representation of state A1 and wherein the second subset of bits is a bit representation of state A2.

  
16. The apparatus of claim 13, wherein N1=22, w1=5, N2=12, and w2=4, and wherein n=8 bits.

  
17. The apparatus of claim 11, wherein the set of n bits further comprises an n+1′th mask bit, and wherein 0≤A≤2 n.

  
18. The apparatus of claim 11, wherein the encoder is configured to encode the first and second subsets of bits in a stateful manner.

  
19. The apparatus of claim 11, further comprising
a receiver configured to receive a third and a fourth codeword of the first and second XR codes via w1 and 2 wires of the multi-wire bus, respectively, and to responsively determine a set of n output bits based on the received third and fourth codewords.


  
20. The method of claim 19, wherein the receiver is configured to generate state representations of the third and fourth codewords, and to form a second integer based on the state representations of the third and fourth codewords, and to responsively generate the set of n output bits representative of the second integer.
Source: [US10057049B2](https://patents.google.com/patent/US10057049B2)

# [US10057049B2](US10057049B2.md) - [US10057049B2](US10057049B2.md) - High performance phase locked loop

## Details

* Date: 2016-04-22
* Inventor: Kandou Labs SA
* Beneficiary: Armin Tajalli

## Other patents

### Backwards
 * US668687A
 * US780883A
 * US3196351A
 * US3636463A
 * US3939468A
 * US4163258A
 * US4181967A
 * US4206316A
 * US4276543A
 * US4486739A
 * [US4499550A](US4499550A.md)
 * US4722084A
 * US4772845A
 * US4774498A
 * US4864303A
 * US4897657A
 * [US4974211A](US4974211A.md)
 * US5017924A
 * US5053974A
 * [US5166956A](US5166956A.md)
 * US5168509A
 * US5266907A
 * US5283761A
 * US5287305A
 * US5311516A
 * US5331320A
 * [US5412689A](US5412689A.md)
 * US5449895A
 * US5459465A
 * US5461379A
 * US5511119A
 * US5553097A
 * US5566193A
 * US5599550A
 * US5626651A
 * US5629651A
 * US5659353A
 * US5727006A
 * US5748948A
 * US5802356A
 * [US5825808A](US5825808A.md)
 * US5856935A
 * US5875202A
 * US5945935A
 * US5949060A
 * US5982954A
 * US5995016A
 * US5999016A
 * [US6005895A](US6005895A.md)
 * [US6084883A](US6084883A.md)
 * US6119263A
 * US6172634B1
 * US6175230B1
 * US6232908B1
 * US20010006538A1
 * [US6278740B1](US6278740B1.md)
 * US6316987B1
 * US20010055344A1
 * US6346007B2
 * US20020034191A1
 * US20020044316A1
 * US6378073B1
 * US20020057592A1
 * US6398359B1
 * US6404820B1
 * US6417737B1
 * US6433800B1
 * [US6452420B1](US6452420B1.md)
 * US20020154633A1
 * US6473877B1
 * US20020163881A1
 * US20020167339A1
 * US6483828B1
 * US20020174373A1
 * US20020181607A1
 * US6509773B2
 * US20030016770A1
 * US6522699B1
 * US20030046618A1
 * [US6556628B1](US6556628B1.md)
 * US20030085763A1
 * US6563382B1
 * JP2003163612A
 * US20030146783A1
 * US6621427B2
 * US20030174023A1
 * US6624699B2
 * US20030185310A1
 * US6650638B1
 * US20030218558A1
 * [US6661355B2](US6661355B2.md)
 * US6664355B2
 * US6690739B1
 * US20040027185A1
 * [US6766342B2](US6766342B2.md)
 * US20040146117A1
 * US6772351B1
 * US20040155802A1
 * US20040161019A1
 * US20040169529A1
 * US6839587B2
 * [US6839429B1](US6839429B1.md)
 * WO2005002162A1
 * US6854030B2
 * US6865236B1
 * US6865234B1
 * US20050063493A1
 * US6876317B2
 * US20050134380A1
 * US6927709B2
 * US20050174841A1
 * US20050195000A1
 * US20050201491A1
 * US20050213686A1
 * US20050220182A1
 * [US6954492B1](US6954492B1.md)
 * US6963622B2
 * US6972701B2
 * US6973613B2
 * US6976194B2
 * [US6990138B2](US6990138B2.md)
 * US6991038B2
 * US6993311B2
 * [US6999516B1](US6999516B1.md)
 * US20060036668A1
 * US7023817B2
 * US7039136B2
 * US20060097786A1
 * US20060103463A1
 * US7053802B2
 * US20060120486A1
 * US20060126751A1
 * US20060133538A1
 * US20060140324A1
 * US7080288B2
 * US20060159005A1
 * US7082557B2
 * US7085153B2
 * US20060233291A1
 * US7127003B2
 * CN1864346A
 * [US7142612B2](US7142612B2.md)
 * US7142865B2
 * US20070002954A1
 * US20070001723A1
 * US7164631B2
 * US7167019B2
 * US20070030796A1
 * US7176823B2
 * [US7180949B2](US7180949B2.md)
 * US7199728B2
 * US20070103338A1
 * US20070121716A1
 * US7231558B2
 * US20070204205A1
 * US7269212B1
 * US7269130B2
 * US20070263711A1
 * US20070283210A1
 * US20080007367A1
 * US20080012598A1
 * US7335976B2
 * US7336112B1
 * US7339990B2
 * US7346819B2
 * US7348989B2
 * US7356213B1
 * US7358869B1
 * US7362697B2
 * US7366942B2
 * US20080104374A1
 * US7370264B2
 * US7372390B2
 * EP1926267A1
 * [US7389333B2](US7389333B2.md)
 * US20080159448A1
 * US7397302B2
 * US7400276B1
 * US20080192621A1
 * US7462956B2
 * US20080317188A1
 * US7496162B2
 * US20090059782A1
 * US20090115523A1
 * US7535957B2
 * US7539532B2
 * US20090154604A1
 * CN101478286A
 * WO2009084121A1
 * US20090195281A1
 * US7599390B2
 * US20090262876A1
 * US7613234B2
 * US7616075B2
 * US7620116B2
 * [US7633850B2](US7633850B2.md)
 * US20090316730A1
 * US7639596B2
 * US20090323864A1
 * US7650525B1
 * US7656321B2
 * US20100046644A1
 * WO2010031824A1
 * US20100081451A1
 * US7694204B2
 * US7698088B2
 * US7697915B2
 * US7706524B2
 * US7706456B2
 * US20100148819A1
 * US20100180143A1
 * US7768312B2
 * US20100215087A1
 * US20100215112A1
 * US7787572B2
 * US20100235673A1
 * US7804361B2
 * US7808456B2
 * US20100296556A1
 * US7841909B2
 * US20100309964A1
 * US7869497B2
 * US7869546B2
 * US20110014865A1
 * US7882413B2
 * US7899653B2
 * US20110051854A1
 * US20110072330A1
 * US20110084737A1
 * US7933770B2
 * US20110103508A1
 * US8000664B2
 * US20110228864A1
 * WO2011119359A2
 * US8030999B2
 * US8036300B2
 * US8050332B2
 * US20110268225A1
 * US8055095B2
 * US8064535B2
 * US20110302478A1
 * [US20110299555A1](US20110299555A1.md)
 * US8085172B2
 * US20110317559A1
 * US8106806B2
 * US8149906B2
 * US20120082203A1
 * [US8159376B2](US8159376B2.md)
 * US8180931B2
 * US8185807B2
 * US8199863B2
 * US8199849B2
 * US20120152901A1
 * US20120161945A1
 * US8218670B2
 * US8233544B2
 * US8245094B2
 * US20120213299A1
 * US8253454B2
 * US8279745B2
 * US8279094B2
 * US20120257683A1
 * US8289914B2
 * US8295336B2
 * US8295250B2
 * US8310389B1
 * US8341492B2
 * US20130010892A1
 * US20130013870A1
 * US8359445B2
 * US8365035B2
 * EP2039221B1
 * US8402801B2
 * US8406316B2
 * US8429495B2
 * US8429492B2
 * US8437440B1
 * US20130114519A1
 * US8442099B1
 * US8443223B2
 * US20130129019A1
 * US20130147553A1
 * US8472513B2
 * US20130188656A1
 * US8498368B1
 * US20130195155A1
 * US20130202065A1
 * US8520348B2
 * US8547272B2
 * US20130259113A1
 * US20130271194A1
 * US8578246B2
 * US8588254B2
 * US8593305B1
 * US20130315501A1
 * US20130314142A1
 * US8604879B2
 * US8602643B2
 * US20130346830A1
 * US8620166B2
 * US8638241B2
 * US8643437B2
 * US8649840B2
 * US8649460B2
 * US8649556B2
 * US8674861B2
 * US8687968B2
 * US8718184B1
 * US20140159769A1
 * US8755426B1
 * US8773964B2
 * US8782578B2
 * US8780687B2
 * US8831440B2
 * US8879660B1
 * US8898504B2
 * US8938171B2
 * US8951072B2
 * US8975948B2
 * US20150070201A1
 * US20150078479A1
 * US8989317B1
 * US9036764B1
 * US20150146771A1
 * US9059816B1
 * US9069995B1
 * US9077386B1
 * US9083576B1
 * US9093791B2
 * US9100232B1
 * US9124557B2
 * US20150249559A1
 * US9148087B1
 * US9152495B2
 * US9172412B2
 * US9178503B2
 * US9183085B1
 * US20150333940A1
 * US9197470B2
 * US20150349835A1
 * US20150381232A1
 * US20150380087A1
 * US20160020824A1
 * US20160020796A1
 * US20160036616A1
 * US9281785B2
 * [US9288082B1](US9288082B1.md)
 * US9292716B2
 * US9300503B1
 * US9306621B2
 * US9331962B2
 * US9374250B1
 * US9432298B1
 * US20160261435A1
 * US9455744B2
 * US9455765B2
 * US9634797B2
 * US20170317449A1
 * US20170317855A1
### Forward
 * US10374787B2
## Abstract

Abstract

Methods and systems are described for receiving N phases of a local clock signal and M phases of a reference signal, wherein M is an integer greater than or equal to 1 and N is an integer greater than or equal to 2, generating a plurality of partial phase error signals, each partial phase error signal formed at least in part by comparing (i) a respective phase of the M phases of the reference signal to (ii) a respective phase of the N phases of the local clock signal, and generating a composite phase error signal by summing the plurality of partial phase error signals, and responsively adjusting a fixed phase of a local oscillator using the composite phase error signal.



Methods and systems are described for receiving N phases of a local clock signal and M phases of a reference signal, wherein M is an integer greater than or equal to 1 and N is an integer greater than or equal to 2, generating a plurality of partial phase error signals, each partial phase error signal formed at least in part by comparing (i) a respective phase of the M phases of the reference signal to (ii) a respective phase of the N phases of the local clock signal, and generating a composite phase error signal by summing the plurality of partial phase error signals, and responsively adjusting a fixed phase of a local oscillator using the composite phase error signal.

CROSS REFERENCE TO RELATED APPLICATIONS
This application claims the benefit of U.S. Provisional Application No. 62/326,591 filed Apr. 22, 2016, entitled “HIGH PERFORMANCE PHASE LOCKED LOOP”, naming Armin Tajalli, which is hereby incorporated by reference in its entirety.
REFERENCES
The following prior applications are herein incorporated by reference in their entirety for all purposes:
U. S. Patent Publication 2011/0268225 of application Ser. No. 12/784,414, filed May 20, 2010, naming Harm Cronie and Amin Shokrollahi, entitled “Orthogonal Differential Vector Signaling” (hereinafter “Cronie I”).
U. S. Patent Publication 2011/0302478 of application Ser. No. 12/982,777, filed Dec. 30, 2010, naming Harm Cronie and Amin Shokrollahi, entitled “Power and Pin Efficient Chip-to-Chip Communications with Common-Mode Resilience and SSO Resilience” (hereinafter “Cronie II”).
U.S. patent application Ser. No. 13/030,027, filed Feb. 17, 2011, naming Harm Cronie, Amin Shokrollahi and Armin Tajalli, entitled “Methods and Systems for Noise Resilient, Pin-Efficient and Low Power Communications with Sparse Signaling Codes” (hereinafter “Cronie III”).
U.S. patent application Ser. No. 13/176,657, filed Jul. 5, 2011, naming Harm Cronie and Amin Shokrollahi, entitled “Methods and Systems for Low-power and Pin-efficient Communications with Superposition Signaling Codes” (hereinafter “Cronie IV”).
U.S. patent application Ser. No. 13/542,599, filed Jul. 5, 2012, naming Armin Tajalli, Harm Cronie, and Amin Shokrollhi entitled “Methods and Circuits for Efficient Processing and Detection of Balanced Codes” (hereafter called “Tajalli I”.)
U.S. patent application Ser. No. 13/842,740, filed Mar. 15, 2013, naming Brian Holden, Amin Shokrollahi and Anant Singh, entitled “Methods and Systems for Skew Tolerance in and Advanced Detectors for Vector Signaling Codes for Chip-to-Chip Communication”, hereinafter identified as [Holden I];
U.S. Provisional Patent Application No. 61/946,574, filed Feb. 28, 2014, naming Amin Shokrollahi, Brian Holden, and Richard Simpson, entitled “Clock Embedded Vector Signaling Codes”, hereinafter identified as [Shokrollahi I].
U.S. patent application Ser. No. 14/612,241, filed Aug. 4, 2015, naming Amin Shokrollahi, Ali Hormati, and Roger Ulrich, entitled “Method and Apparatus for Low Power Chip-to-Chip Communications with Constrained ISI Ratio”, hereinafter identified as [Shokrollahi II].
U.S. patent application Ser. No. 13/895,206, filed May 15, 2013, naming Roger Ulrich and Peter Hunt, entitled “Circuits for Efficient Detection of Vector Signaling Codes for Chip-to-Chip Communications using Sums of Differences”, hereinafter identified as [Ulrich I].
U.S. patent application Ser. No. 14/816,896, filed Aug. 3, 2015, naming Brian Holden and Amin Shokrollahi, entitled “Orthogonal Differential Vector Signaling Codes with Embedded Clock”, hereinafter identified as [Holden II].
U.S. patent application Ser. No. 14/926,958, filed Oct. 29, 2015, naming Richard Simpson, Andrew Stewart, and Ali Hormati, entitled “Clock Data Alignment System for Vector Signaling Code Commuications Link”, hereinafter identified as [Stewart I].
U.S. patent application Ser. No. 14/925,686, filed Oct. 28, 2015, naming Armin Tajalli, entitled “Advanced Phase Interpolator”, hereinafter identified as [Tajalli II].
U.S. Provisional Patent Application No. 62/286,717, filed Jan. 25, 2016, naming Armin Tajalli, entitled “Voltage Sampler Driver with Enhanced High-Frequency Gain”, hereinafter identified as [Tajalli III].
The following additional references to prior art have been cited in this application:
U.S. Pat. No. 6,509,773, filed Apr. 30, 2001 by Buchwald et al., entitled “Phase interpolator device and method” (hereafter called [Buchwald].
“Linear phase detection using two-phase latch”, A. Tajalli, et al., IEE Electronic Letters, 2003, (hereafter called [Tajalli IV].)
“A Low-Jitter Low-Phase-Noise 10-GHz Sub-Harmonically Injection-Locked PLL With Self-Aligned DLL in 65-nm CMOS Technology”, Hong-Yeh Chang, Yen-Liang Yeh, Yu-Cheng Liu, Meng-Han Li, and Kevin Chen, IEEE Transactions on Microwave Theory and Techniques, Vol 62, No. 3, March 2014 pp. 543-555, (hereafter called [Chang et al.])
“Low Phase Noise 77-GHz Fractional-N PLL with DLL-based Reference Frequency Multiplier for FMCW Radars”, Herman Jalli Ng, Rainer Stuhlberger, Linus Maurer, Thomas Sailer, and Andreas Stelzer, Proceedings of the 6th European Microwave Integrated Circuits Conference, 10-11 Oct. 2011, pp. 196-199, (hereafter called [Ng et al.])
“Design of Noise-Robust Clock and Data Recovery using an Adaptive-Bandwidth Mixed PLL/DLL”, Han-Yuan Tan, Doctoral Thesis, Harvard University November 2006, (hereafter called [Tan]).
FIELD OF THE INVENTION
The present embodiments relate to communications systems circuits generally, and more particularly to obtaining a stable, correctly phased receiver clock signal from a high-speed multi-wire interface used for chip-to-chip communication.
BACKGROUND
In modern digital systems, digital information has to be processed in a reliable and efficient way. In this context, digital information is to be understood as information available in discrete, i.e., discontinuous values. Bits, collection of bits, but also numbers from a finite set can be used to represent digital information.
In most chip-to-chip, or device-to-device communication systems, communication takes place over a plurality of wires to increase the aggregate bandwidth. A single or pair of these wires may be referred to as a channel or link and multiple channels create a communication bus between the electronic components. At the physical circuitry level, in chip-to-chip communication systems, buses are typically made of electrical conductors in the package between chips and motherboards, on printed circuit boards (“PCBs”) boards or in cables and connectors between PCBs. In high frequency applications, microstrip or stripline PCB traces may be used.
Common methods for transmitting signals over bus wires include single-ended and differential signaling methods. In applications requiring high speed communications, those methods can be further optimized in terms of power consumption and pin-efficiency, especially in high-speed communications. More recently, vector signaling methods have been proposed to further optimize the trade-offs between power consumption, pin efficiency and noise robustness of chip-to-chip communication systems. In such vector signaling systems, digital information at the transmitter is transformed into a different representation space in the form of a vector codeword that is chosen in order to optimize the power consumption, pin-efficiency and speed trade-offs based on the transmission channel properties and communication system design constraints. Herein, this process is referred to as “encoding”. The encoded codeword is communicated as a group of signals from the transmitter to one or more receivers. At a receiver, the received signals corresponding to the codeword are transformed back into the original digital information representation space. Herein, this process is referred to as “decoding”.
Regardless of the encoding method used, the received signals presented to the receiving device must be sampled (or their signal value otherwise recorded) at intervals best representing the original transmitted values, regardless of transmission channel delays, interference, and noise. Such Clock and Data Recovery (CDR) not only determines the appropriate sample timing, but may continue to do so continuously, providing dynamic compensation for varying signal propagation conditions.
Many known CDR systems utilize a Phase-Locked Loop (PLL) or Delay-Locked Loop (DLL) to synthesize a local receive clock having an appropriate frequency and phase for accurate receive data sampling.
BRIEF DESCRIPTION
To reliably detect the data values transmitted over a communications system, a receiver must accurately measure the received signal value amplitudes at carefully selected times. Various methods are known to facilitate such receive measurements, including reception of one or more dedicated clock signals associated with the transmitted data stream, extraction of clock signals embedded within the transmitted data stream, and synthesis of a local receive clock from known attributes of the communicated data stream.
In general, the receiver embodiments of such timing methods are described as Clock-Data Recovery (CDR), often based on Phase-Lock Loop (PLL) or Delay-Locked Loop (DLL) synthesis of a local receive clock having the desired frequency and phase characteristics.
In both PLL and DLL embodiments, a phase comparator compares the relative phase (and in some variations, the relative frequency) of a received reference signal and a local clock signal to produce an error signal, which is subsequently used to correct the phase and/or frequency of the local clock source and thus minimize the error. As this feedback loop behavior will lead to a given PLL embodiment producing a fixed phase relationship (as examples, 0 degrees or 90 degrees of phase offset) between the reference signal and the local clock, an additional fixed or variable phase adjustment is often introduced to permit the phase offset to be set to a different desired value (as one example, 45 degrees of phase offset) to facilitate receiver data detection.
Below, methods and systems are described for receiving N phases of a local clock signal and M phases of a reference signal, wherein M is an integer greater than or equal to 1 and N is an integer greater than or equal to 2, generating a plurality of partial phase error signals, each partial phase error signal formed at least in part by comparing (i) a respective phase of the M phases of the reference signal to (ii) a respective phase of the N phases of the local clock signal, and generating a composite phase error signal by summing the plurality of partial phase error signals, and responsively adjusting a fixed phase of a local oscillator using the composite phase error signal.
In some embodiments, M=1, and N partial phase error signals are summed to generate the composite phase error signal. Alternatively, the plurality of partial phase error signals includes M=N partial phase error signals, and wherein a given phase of the N phases of the local clock signal and a given phase of the M phases of the reference signal are each used to generate a single partial phase error signal. In further alternative embodiments, the plurality of partial phase error signals includes M×N partial phase error signals, and wherein each phase of the N phases of the local clock signal is compared to each phase of the M phases of the reference signal.
In some embodiments, each partial phase error signal of the plurality of partial phase error signals has a corresponding weight applied to it. In some embodiments, the weights are selected according to an M×N matrix.
In some embodiments, the M phases of the reference signal are received from a delay-lock loop operating on an input reference signal.
In some embodiments, at least one of the N phases of the local clock signal is generated using a phase interpolator operating on local oscillator signals and a phase offset signal. In some embodiments, generating at least one of the N phases of the local clock signal includes interpolating 4 phases using 4 differential pairs in the phase interpolator, each of the 4 phases being interpolated according to a corresponding differential pair connected to an independently tunable current source.
In some embodiments, at least one partial phase error signal is generated using a pair of flip-flops, wherein a first flip-flop of the pair of flip-flops is clocked using a given phase of the M phases of the reference signal and a second flip-flop is clocked using a given phase of the N phases of the local clock signal.
In some embodiments, each partial phase error signal is an analog signal generated using a respective charge pump, the respective charge pump receiving respective charge pump control signals generated by a respective comparison between the respective phase of the M phases of the reference signal and the respective phase of the N phases of the local clock signal.
Embodiments are described in which the Phase Detection and phase adjustment elements are combined, leading to lower circuit node capacitance and reduced circuit delays, these improvements in turn enabling increased loop stability and improved PLL lock characteristics, including increased loop lock bandwidth leading to lower clock jitter and improved power supply noise rejection.
Embodiments are also described in which a Delay-Locked Loop is used to convert the received reference clock signal into multiple reference clock phases, converting the PLL phase comparison operation into multiple comparisons made between a reference clock phase and a local clock phase. A summation or weighted summation of the multiple comparison results is then used as the error feedback signal for the PLL. A further embodiment is described in which multiple comparisons are made between a single received reference clock phase and multiple local clock phases, with the weighted sum of the multiple comparison results used as the error feedback term for the PLL. In at least one such further embodiment, said weighted sums comprise a two dimensional time domain filter.

BRIEF DESCRIPTION OF FIGURES
 FIG. 1 is a block diagram of one embodiment capable of encoding and transmitting five data bits and a clock on an eight wire communications channel.
 FIG. 2 is a block diagram of one embodiment of a receiver compatible with the transmitter of FIG. 1.
 FIG. 3 is a block diagram detailing one embodiment of the clock recovery circuit used by the receiver of FIG. 2.
 FIGS. 4A, 4B, and 4C show three Phase comparator embodiments suitable for use in a Phase Locked Loop element of a clock recovery circuit.
 FIG. 5 is a schematic diagram of one embodiment integrating an XOR phase comparator and clock phase interpolator.
 FIG. 6A is a schematic diagram of a clocked data latch and FIG. 6B is a schematic diagram of a further embodiment of a clocked data latch integrating a clock phase interpolator.
 FIGS. 7A and 7B are schematic diagrams of an embodiment integrating a state machine phase comparator and clock phase interpolators.
 FIG. 8 is a schematic diagram of one embodiment of a charge pump suitable for further integration with a phase comparator embodiment.
 FIG. 9 is a block diagram of a further embodiment in which multiple phases of a reference clock are compared with multiple local clock phases.
 FIG. 10 is a block diagram of a further embodiment in which multiple comparisons are made between a single reference clock and multiple local clock phases.
 FIG. 11A is a weighted XOR phase comparator, in accordance with some embodiments.
 FIG. 11B is a block diagram of one embodiment of a matrix phase comparison of M reference phases and N local clock phases.
 FIGS. 12A and 12B are block diagrams of an alternate embodiment of the integrated phase comparator and phase interpolator of FIG. 5.
 FIG. 13A is a timing diagram for a folded phase comparator, in accordance with some embodiments.
 FIG. 13B is timing diagram illustrating a reverse clipping effect, in accordance with some embodiments.
 FIGS. 14A and 14B are timing diagrams for an array-XOR phase comparator and single-XOR phase comparator, respectively, in accordance with some embodiments.
 FIG. 15 is a flowchart of a method, in accordance with some embodiments.

DETAILED DESCRIPTION
As described in [Cronie I], [Cronie II], [Cronie III] and [Cronie IV], vector signaling codes may be used to produce extremely high bandwidth data communications links, such as between two integrated circuit devices in a system. As illustrated by the embodiment of FIG. 1, multiple data communications channels transmit symbols of the vector signaling code, acting together to communicate codewords of the vector signaling code. Depending on the particular vector signaling code used, the number of channels comprising a communications link may range from two to eight or more, and may also communicate one or more clock signals on separate communications channels or as subchannel components of the vector signaling code. In the example of FIG. 1, communication link 120 is illustrated as being composed of eight wires 125, collectively communicating five data values 100 and one clock 105 between transmitter 110 and receiver 130.
Individual symbols, e.g. transmissions on any single communications channel, may utilize multiple signal levels, often three or more. Operation at channel rates exceeding 10 Gbps may further complicate receive behavior by requiring deeply pipelined or parallelized signal processing, precluding reception methods in which the previous received value is known as the current value is being received.
Embodiments described herein can also be applied to prior art permutation sorting methods not covered by the vector processing methods of [Cronie II], [Cronie III], [Cronie IV], and/or [Tajalli I]. More generally, embodiments can apply to any communication or storage methods requiring coordination of multiple channels or elements of the channel to produce a coherent aggregate result.
Receiver Data Detection
To provide context for the following examples, one typical high-speed receiver embodiment [Stewart I] is used for illustrative purposes, without limitation.
As illustrated in FIG. 2, the example data receiver includes eight identical Continuous Time Linear Equalization (CTLE) stages 210 operating on the signals received on the eight wires, previously shown as 120 in FIG. 1.
As described in [Tajalli I], [Holden I] and [Ulrich I], vector signaling codes may be efficiently detected by linearly combining sets of input signals using Multi-Input comparators or mixers (MIC). For the 5b6w code used by the example receiver, five such mixers acting on weighted subsets of the six received data input signals will detect the five data bits without need of further decoding. One additional mixer acting on combinations of the two received clock signals will similarly detect the clock signal. In FIG. 2, this set of six MIC mixers 220 operate on the received and equalized signals to produce detected signals MIC0-MIC5.
Because of the high data rates involved, multiple parallel phases of receive processing may be used in the example receiver. In one embodiment, the five detected data signals MIC0-MIC4 are processed in four parallel phases of receive data processing, each phase 230 including five data samplers and subsequent buffering, followed by recombination of the four phase outputs into a received data stream, shown in FIG. 2 as being performed by multiplexers 240.
Clock Recovery circuits (also known in the art as Clock Data Recovery or CDR) support such sampling measurements by extracting timing information, either from the data lines themselves or from dedicated clock signal inputs, and utilize that extracted information to generate clock signals to control the time interval used by the data line sampling device(s). The actual clock extraction may be performed using well known circuits such as a Phase Locked Loop (PLL) or Delay Locked Loop (DLL), which in their operation may also generate higher frequency internal clocks, multiple clock phases, etc. in support of receiver operation. In the embodiment of FIG. 2, the detected clock signal is obtained at MIC5 and processed 300 to extract properly timed sampling clocks for the four data phases.
PLL Overview
Phase Locked Loops are well represented in the literature. A typical PLL is composed of a phase comparator that compares an external reference signal to an internal clock signal, a low pass filter that smoothes the resulting error value to produce a clock control signal, and a variable frequency clock source (typically, a Voltage Controlled Oscillator or VCO) controlled by the smoothed error value, producing the internal clock signal presented to the phase comparator. In a well-know variation, such a PLL design may incorporate a clock frequency divider between the VCO and the phase comparator, allowing a higher-frequency clock output to be phase locked to a lower-frequency reference signal.
In an alternative embodiment, the variable frequency clock source is replaced by a variable delay element, its (optionally multiple tapped) outputs thus representing one or more successive time-delayed versions of the original input signal rather than successive cycles of an oscillator to be phase compared to the reference input signal. For the purposes of this document, such Delay Locked Loops (DLL) are considered functionally equivalent to a PLL in such an application, particularly in regard to comprised elements of phase comparator, phase interpolator, and charge pump.
Numerous forms of phase comparators are known to the art. A simple XOR gate as in FIG. 4A may be used to compare, as a non-limiting example, two square wave signals. One familiar with the art will observe that such a digital XOR output will be a variable-duty-cycle waveform which, when low pass filtered into an analog error signal, results in a proportional error signal centered in its analog signal range when the two input signals have a 90-degree phase offset relationship.
The more complex state machine phase comparator of FIG. 4B is composed of two edge-triggered latches clocked respectively by the reference and internal clock signals, with the first received clock edge initiating an output signal on one of the “early” or “late” outputs. Either output becoming active will subsequently cause the latches to reset in anticipation of the next comparison interval. Alternative embodiments may incorporate a timing delay in this reset path to provide additional control of the reset pulse timing. The “late” and “early” phase comparison outputs are typically accepted as “pump up” and “pump down” inputs to a charge pump, the output of which is the analog error value. That is, a pump-up signal may turn on a first transistor circuit that provides charge to capacitor thereby increasing the analog voltage, while a pump down signal may turn on a second transistor circuit that removes charge from a capacitor, thereby reducing the voltage. A zero-degree phase offset between the two input clock signals will thus leave the analog error value unchanged and the PLL in a stable locked condition. Several equivalent state machine phase comparator embodiments are known in the art, and are equally applicable in this application, without implication of limitation. Some state machine embodiments may be sensitive to both phase and frequency differences between the input signals, facilitating more rapid PLL lock acquisition on startup.
As shown in FIG. 4C, a simple edge-clocked “D” flip-flop may also be used as a phase comparator. At each rising local clock edge (CkPLL), the D input samples the state of the (in this example, square wave) reference input (CkRef); if it is high (e.g. it has already transitioned,) the Q output is high indicating the reference is “early”, if it is low (e.g. it has not yet transitioned,) Q is low indicating the reference is “late”. This so-called “bang/bang” phase comparator provides a less nuanced error result than the previous example, thus more sophisticated filtering may be performed to obtain loop stability.
As will be recognized by those familiar with the art, comparable functional operation may be obtained regardless of the phase comparator type incorporated in a PLL design, thus to first approximation phase comparator choice is not limiting. Secondary design behaviors, including lock time, stability, power consumption, etc. must also be considered as part of the design process.
Receiver Clock Recovery
The example receiver utilizes a PLL embodiment as shown in FIG. 3. This PLL accepts the received clock signal R5 as the reference to which its clocks will be phased locked. In some embodiments, logic level shift 310 is used if appropriate to interface between the signal levels provided by the detecting MIC and the preferred phase comparator input levels. Phase Comparator 320 compares the reference clock to a local clock derived from the VCO, producing an output which is low pass filtered to provide an Error value which subsequently corrects the operating frequency of VCO 340. In some embodiments, the outputs of Phase Comparator 320 is a digital waveform requiring conversion to an analog error signal, either through implicit or explicit digital to analog conversion, or by use of an interface element such as a charge pump. Some embodiments may combine such conversion with all or part of the low pass filtering operation, as one example offered without limitation, by the digital filtering behavior shown by the switching action of a charge pump directed by digital control signals generating an analog signal output.
In at least one embodiment, a ring oscillator 340 composed of a sequence of identical gates in a closed loop is used as the internal Voltage Controlled Oscillator (VCO) timing source for the PLL. The VCO frequency is varied by analog adjustment of at least one of: gate propagation delay, inter-gate rise and fall time, and gate switching threshold within the ring oscillator. This may be implemented via switched capacitor banks, where a digital control signal is applied to selective place capacitive elements in parallel and/or series combinations to alter an RC time constant, as one non-limiting example. Still further, a current source that drives a gate of the ring oscillator may be increased or decreased to alter the output switching rise-time/fall-time, and thereby adjust the effective delay. Outputs taken at equal intervals (i.e. separated by equal numbers of ring oscillator gates) along the sequence of gates comprising the ring oscillator provide the four data phase sampling clocks, herein identified as the 0, 90, 180, and 270 degree clocks.
In one embodiment, the ring oscillator is composed of eight identical sets of logic gates (e.g., a set of inverter circuits), thus the phase difference from one such set to the next is 45 degrees. In this embodiment, the 0, 90, 180, and 270 degree outputs may be obtained, as examples, from the second, fourth, sixth, and eighth outputs. As many variations of such designs are known in the art, neither the number of elements in the ring oscillator nor the specific taps at which particular outputs are made should be construed as implying a limitation. As one example, the location of the 0 degree tap is arbitrary, as one familiar with the art will recognize that normal PLL behavior will phase align the ring oscillator with the external phase reference regardless of its initial phase. Similarly, equivalent designs may be obtained in which the output clock phases do not have square wave duty cycles; as one example being produced by the action of AND or OR gates with inputs from different tap locations. In the example receiver, it is desired that the VCO operate at a multiple of the received reference clock frequency, thus Frequency Divider 350 divides the VCO outputs by a comparable amount prior to the phase comparator. In one embodiment, binary (factor of two) dividers are used at 350 to obtain the correct sampling clock rate. In another embodiment, no divider is used, and the VCO outputs are presented to the phase interpolator directly.
Each of the four phases of sampling clocks is appropriately timed to sample received data for one of the four parallel processing phases. In particular, internal clock ph000 is aligned to optimally trigger data samplers in the phase0 phase of processing, clock ph090 in phase1, clock ph180 in phase2, and clock ph270 in phase3.
To allow the overall phase of the locked PLL signals to be offset from the reference clock input phase, the local clock output presented to the phase comparator is obtained from phase interpolator 360, the output phase of which is controllably intermediate between its input clock phases. Thus, the PLL may lock with its fixed phase relationship, while the internal clock signals obtained from ring oscillator 340 will be offset from that fixed phase by the phase delay amount introduced by phase interpolator 350, as controlled by signal Phase offset correction. Phase interpolators are known in the art, examples being provided by [Buchwald I] and [Tajalli II].
In one embodiment, phase interpolator 360 receives multiple local clock phases from the ring oscillator 340 having 90 degree phase differences. Said phase interpolator may be controlled to select two adjacent clock input phases and then to interpolate between them so as to produce an output at a chosen phase offset between the two selected values. For purposes of description, it may be assumed that a phase comparator design is used which drives the PLL to lock with a zero phase differential between the two phase comparator inputs. Thus, continuing the example, applying the 0 and 90 degree clock phases as inputs to the phase interpolator allows adjustment such that the PLL leads the reference clock input by between 0 and 90 degrees.
It will be apparent that equivalent results with comparable phase offsets may be obtained using other pairs of degree clocks and/or other phase comparator designs, which as previously described may lock with different phase differentials than that of the present example. Thus, neither the particular phase clocks chosen nor the particular phase comparator design described herein are limiting.
Phase Comparator with Interpolator
As communication channel data rates increase, it becomes increasingly difficult to maintain acceptable PLL lock range and accuracy, as inherent and parasitic circuit node capacitances introduce circuit delays and constrain the effective loop response bandwidth. An embodiment providing improved response characteristics suitable for such high-speed operation is illustrated in FIG. 5. As one familiar with the art will observe, this is a CMOS design providing symmetrical operation for both positive and negative output excursions, integrating elements of both phase interpolator and phase comparator designs. This tight integration results in reduced node capacitances, facilitating the desirable high speed operation, and the balanced differential structure simplifies the control of charge and discharge currents.
As with conventional designs, the PLL VCO (or a clock divider driven by said VCO) provides the local oscillator inputs to phase interpolator elements 510 and 515, which together set the effective local clock phase. Four local oscillator phases with 90-degree offset are shown i.e. equivalent to two phases in quadrature relationship and their complimentary signals and thus identified as +I, +Q, and −I, −Q, permitting a full 360 degree or “four quadrant” phase adjustment. Other embodiments may utilize as few as two local oscillator phases, may use oscillator phases having other than 90-degree phase differences, or may select clock phases from an input set of more than four; as one non-limiting example, choosing at least two clock phases to be interpolated between from an input set of eight clock phases.
In a first embodiment, phase interpolator element 510 includes four mixing elements, each mixing element comprising a differential transistor pair and a controlled current source, with a common differential output driven by the four mixing elements in parallel. Thus, configuration of current source IA(i) controls the amount of local oscillator phase +I presented to the common output ckp; similarly, current source IA(−i) controls the amount of complimentary output phase −I in the output, IA(q) controls the amount of +Q, and IA(−q) controls the amount of −Q. It will be readily apparent to one familiar with the art that configuration of the four current sources can produce an output clock at Ckp having any desired phase relationship to the PLL local clock input.
Similarly, phase interpolator element 515 current sources IB(i), IB(−i), IB(q), and IB(−q) may be configured to obtain an output clock at Ckn having any desired phase relationship to the PLL local clock input. In some embodiments, CkPLLp and CkPLLn may be configured to have complimentary relationships to provide phase comparator 520 with balanced and complimentary positive- and negative-going current amplitudes. However, configuration with non-complimentary IA and IB values may be performed to obtain particular results. As one example offered without limitation, an embodiment separately adjusting IA and IB values might obtain higher resolution phase adjustment, compared to an embodiment maintaining perfectly complimentary IA and IB values.
The second input to the phase comparator 520 is external reference clock CkRef+/CkRef−, producing the phase error output currents VCOctl+/VCOctl−. In one advanced embodiment, the two external reference clocks are of opposing polarity but not necessarily complementary phase, thus the positive polarity comparison and negative polarity comparison represent different phase comparisons. Such an advanced embodiment may be combined with non-complimentary IA and IB bias configurations, providing independent adjustment of local clock phase during those different phase comparisons. That is, in one embodiment, the CkRef input at the top of PD 520 is a first phase selected from the reference clock phases available in the circuit, and the IA currents are adjusted to provide a corresponding interpolated phase offset from the first selected phase, and the CkRef input at the bottom of PD 520 is a second phase selected from the reference clock phases available in the circuit, and the IB currents are adjusted to provide a corresponding interpolated phase offset from the second selected phase, wherein the amount of the relative phase offsets are the same.
Configuration of phase interpolator current source values may be performed by external control logic, including without limitation, a hardware configuration register, control processor output register, and hardware CDR adjustment logic.
Alternative Phase Comparator Embodiments
Phase comparator 520 in the embodiment of FIG. 5 is shown as an XOR-style device as in FIG. 4A, mixing local clock CkPLL and external reference clock CkRef to produce phase error output VCOctl. In the alternative embodiment of FIG. 12A, a folded phase comparator is used at 1220, driven by currents produced by the combination of phase interpolator 510 and current sink Ifix2, and the combination of phase interpolator 520 and current source Ifix1. The folded phase comparator embodiment shown in FIG. 12A is described in further detail below. As with the previously-described embodiment, current sources IA(i), IA(−i), IA(q), and IA(−q) are configured to produce the desired interpolation of PLL clocks i, q, and −q in interpolator outputs CkPLLp and CkPLLp, while current sources IB(i), IB(−i), IB(q), and IB(−q) are configured to produce the desired interpolation of PLL clocks i, −i, q, and −q in interpolator outputs CkPLLn and CkPLLn. Phase comparator 1220 is also driven by received reference clocks CkRef+ and CkRef−, producing phase comparison results Phase Error (+) and Phase Error (−). In some embodiments, the circuit node labeled Circuit Balance Feedback may be monitored to determine the relative DC component of the interpolated clock signals, which may then be modified by adjustment of the configured current source values in 510 and 515. In some embodiments, each current source IA and IB receives seven control bits. It should be noted that embodiments are not limited to receiving seven control bits, and that any number of control bits may be implemented according to design constraints for PI resolution, for example. In some embodiments, current sources IA and IB are equal (e.g., IA=IB for +/−i, q). In such embodiments, the PIs 510 and 515 have 7 bits of resolution. In alternative embodiments, additional resolution may be implemented by introducing a shift in IB with respect to IA, or vice versa. In an exemplary embodiment, IA=IB+8, where 8 is a decimal shift added to the control bits of each current source IA to obtain the control bits of each current source IB. In such embodiments, the P-side PI 510 and N-side PI 515 are receiving two different VCO phases, and the phase comparator collects information from different phases of the VCO. Since the PIs 510 and 515 combine information from different phases of VCO, the PLL has more detailed information about phases of PLL and the bandwidth of the PLL is higher than a conventional PLL.
Embodiments for which IA=IB+shift are a special case of a matrix phase comparator in which there are two partial phase comparators. The first partial phase comparator (N-side XOR) compares the phase of reference with one set of VCO feedback phases, and a second partial phase comparator (P-side XOR) that compares the reference clock phase with a second set of VCO feedback phases. Matrix phase comparator embodiments are described in further detail below.
In some embodiments, a folded structure as shown in FIG. 12A may be used. FIG. 12A is similar to the embodiment shown in FIG. 5, however the phase comparator 520 is replaced with a folded phase comparator 1220. As shown, folded phase comparator 1220 includes current sources Ifix1 and Ifix2, which may be configured to provide more voltage headroom to the PMOS PI current sources IA and the NMOS PI current sources IB. Further, phase comparator 1220 includes a pair of transistor branches connected to CkPLLp and CkPLLn. For purposes of illustration, consider PI 510 and 515 only having IA(i) and IB(i) turned on respectively, representing phase ph0000 from the VCO. In the case where CkRef is offset 90 degrees from ph0000, the folded phase comparator 1220 will be in lock condition. As shown in FIG. 13A, during the first 180 degrees (1) of a period, for a first 90 degrees (2), current Ip is charged to the (−) terminal of the Phase Error signal through transistor 1206 using PMOS PI 510. At the same time, current In is discharged from the (−) terminal of the Phase Error signal through transistor 1208 using NMOS PI 515. Similarly, during the second 90 degrees (3), current Ip is charged from the (+) terminal of the Phase error signal through transistor 1202, while current In is discharged from the (+) terminal through transistor 1204. As shown, Ifix2 will sink a fixed amount of current being provided from PMOS PI 510, while Ifix 1 sources some current to NMOS PI 515 to prevent the current sources in the NMOS PI from sinking too much current from the Phase Error signal. Such a technique provides a reverse clipping effect. One of skill in the art may notice that equally adjusting the Ifix current magnitudes may have an effect on the range of the Phase Error signal. In some embodiments, increasing the Ifix magnitudes will lower the magnitude range of the Phase Error signal, while decreasing the Ifix magnitudes will increase the magnitude range of the Phase Error signal. This relationship is illustrated by FIG. 13B.
 FIG. 13B is a timing diagram illustrating the reverse clipping feature described above. FIG. 13B depicts the magnitude of current Ip in the first 180 degrees (1) for two values of Ifix2: A and B, where A>B. As shown, the magnitude of Ip is less in the case of Ifix2=A. When Ifix2=B, the magnitude range of Ip is relatively higher. One of skill in the art would notice a similar effect occurs in the case of In being discharged from the folded phase comparator 1220.
In some embodiments, the second 180 degrees (4) may be used to provide circuit balance feedback, as shown in FIG. 12A. During the circuit balance feedback phase (4), current may be charged via the PMOS PI 510 while current is discharged via the NMOS PI 515. If there is an imbalance of charge/discharge currents, a non-zero circuit balance feedback signal may indicate this imbalance, which may occur due to transistor mismatches, for example. The circuit balance feedback signal may then be used to adjust either Ifix1 or Ifix2 to balance the charge/discharge currents so that the balance feedback signal is zero. In some embodiments, the voltages of the charge-pump circuit may be monitored, and if equal, the circuit is properly balanced, i.e., Ip=In. A simplified schematic of the phase comparator circuit of FIG. 12A is shown in FIG. 12B.
The phase comparator of [Tajalli IV] may alternatively be used at 520 or 1220, providing equivalent phase detection with enhanced signal headroom in embodiments utilizing low power supply voltages. Other phase comparators, including all variations shown in FIGS. 4A, 4B, and 4C, may also be substituted at 520 in that embodiment.
As one example of such alternative embodiment, the State Machine Phase/Frequency Detector of FIG. 4B may be combined with the Phase Interpolator design of FIG. 5.
 FIG. 6A shows a schematic of one embodiment of a conventional CIVIL clocked latch, composed of a clocked feedback latch outputting results Q and Q the state of which is initialized by clocked differential inputs D and D. FIG. 6B shows the same circuit in which the clock source phase is modified by phase interpolator 615, operation of which is as previously described for FIG. 5.
Substituting the clocked latch circuit of FIG. 6B into each D flip-flop instance of FIG. 4B produces the alternative embodiment shown in FIGS. 7A and 7B. D flip-flop 710 is clocked by the received clock CkRef, which is passed through phase interpolator 715. As an example and for purposes of explanation, without a configured phase offset (or a desired offset of 0 degrees), current source IA would be set to “mix” input CkRef at 100% proportion, and the other three current sources set to zero current. D flip-flop 720 is clocked by local clock CkPLL, which is obtained by configuration of phase interpolator 725 current sources IB(i), IB(−i), IB(q), and IB(−q), which in turn controls the relative proportions and polarities of I and Q clocks being combined. In one embodiment, I is obtained from ph000, −I from ph180, Q from ph090, and −Q from ph270, as seen in FIG. 3. A simple CML OR gate 730 drives the reset function for flip-flops 710 and 720.
It should be noted that in this one embodiment the majority of phase interpolator 715 is functionally disabled and retained only to preserve the same parasitic load characteristics as are presented by active phase interpolator 725, to maximize circuit symmetry and maintain balanced loading characteristics to minimize secondary effects such as detection bias and drift.
Integrated Phase Comparator, Interpolation, and Charge Pump
As previously described, PLL phase comparator outputs are typically used to drive a charge pump circuit (CPC), the output of which is an analog error signal used to control the VCO. The described improvement from reduced capacitance and resulting higher circuit speed in integrating the PLL phase comparator and clock adjustment phase interpolator may be further extended by also integrating elements of the charge pump in the same manner.
In this combined embodiment, the charge pump control signals UPp, UPn, DOWNp, and DOWNn provided by the embodiment shown in FIGS. 7A and 7B directly control the charge pump embodiment of FIG. 8 to produce output IOUT. Current source ICPC and voltage reference VREF may be configured to scale and adjust the IOUT range. One familiar with the art will note the significant symmetry in the circuit of FIG. 8, allowing accurate tracking between generation of VREPLICA and IOUT signals.
 FIG. 8 is a schematic of a charge pump circuit with improved charge/discharge current balancing, in accordance with some embodiments. The circuit 800 includes two parallel charge pumps 802, 804: the two differential pairs within charge pump 804 generate an output current representing a phase error signal in response to the up and down pulses, and the two differential pairs of charge pump 802 are used to set the discharge current to be equal to the charge current as described below. Specifically, the current source ICPC sets a charging current level by providing a corresponding bias voltage VBP through a current mirroring circuit to drive the top current sources 806, 808 of the two charge pumps so as to also provide ICPC to each charge pump 802, 804. When UPn goes low and turns on field effect transistor (FET) 810, the node 812 is charged (capacitive element 814 is either a discrete cap or a parasitic cap) by the charging current ICPC provided by FETs 806, 810. In a balanced condition (i.e., in the absence of a phase error), the amount of current that is then discharged during a high DOWNp signal through the bottom FET 816 should bring the node 812 back to the VREF value. If the discharge current is too low and the voltage VREPLICA increases above VREF, then the amplifier 820 will increase the bias voltage VBN to the discharge-current FET 818 to increase the amount of discharge current so that it equals the charge current ICPC and the voltage VREPLICA at node 812 is brought back to VREF. On the other hand, if the discharge current set by VBN on FET 818 is too high, the VREPLICA voltage drops too low, and the amplifier 820 responsively reduces the bias voltage VBN on discharge-FET 818 to bring the charge pump currents into equilibrium.
Other embodiments may be obtained by equivalent combination of phase comparator, phase interpolator, and charge pump elements.
Oversampling of Input Reference Signal
The asymmetric use of the phase interpolators in, as one example, FIGS. 7A and 7B, stems from the different nature of the local clock and reference clock sources. The former is obtained from a multiphase clock source (e.g. an oscillator or divider) inherently capable of providing the multiphase inputs for use by a phase interpolation element. The latter is generally single phased, obtained from (typically) one received clock source.
In the known art, [Tan] described a combined DLL/PLL structure, in which the voltage controlled delay line incorporated in the PLL VCO is duplicated as an input delay line acting on the reference clock input, and controlled by a single feedback error signal. [Ng] and [Chang] also describe use of a front-end DLL to serve as a frequency multiplier to facilitate generation of very high frequency clocks.
However, if such a controlled delay line is tapped, and so configured that the differential delay between taps is proportional to the time between received clock edges, a received clock passing through such a delay line produces a resulting set of outputs which take on some of the characteristics of a multiphase clock. As one example offered without limitation, the equal-interval outputs of a four-tap delay line having an overall delay comparable to the reference clock period will provide outputs having similar characteristic to quadrature phased clock signals. Continuing this example, if each such output is phase compared to an appropriately-selected local clock phase, a series of phase error results will be produced which may be combined to produce a more accurate aggregate clock error signal for the PLL VCO. The delayed versions of the receive clock represent additional opportunities for phase comparison with a clock derived from the VCO, thus providing a higher update rate for the controlled loop, and thus improved PLL loop bandwidth leading to reduced jitter and better noise immunity. That is, using this technique, the update rate of the loop will be increased, which in turn enables the circuit to track and correct the effects of noise and jitter at higher frequencies.
For the delayed phase comparisons to provide meaningful information to the PLL, the delay intervals provided by the delay line must be coordinated with the period between local clock phases, with such controls giving the delay element many of the aspects of a Delay-Locked Loop (DLL.) As seen in the block diagram of FIG. 9, the external clock reference input to the previous PLL embodiment 300 is provided by DLL 910. The received clock signal R5 is presented to tapped delay line 916, producing a series of received clock phases 918. The DLL control loop is provided by phase comparator 912 comparing the received clock with a delayed clock, producing an error value that is low pass filtered 915, producing a delay adjust signal controlling the delay line timing.
Within PLL 300, the previous simple phase comparison (320 of FIG. 3) is now performed by multi-phase comparator 920. In at least one embodiment, XOR gates compare the phase of each received reference clock signal on the N lines (e.g., N=2, 4, 8, etc., and possibly including odd integers as well to obtain other phases such as 60, 120, 180, 240, 300) 918 with a different clock phase from the N phases of the local clock signal on lines 965 from phase interpolator 360. Each XOR gate output representing a partial phase error signal may be converted to an analog signal value, all such analog partial phase error signals being summed using a summation circuit 935 to produce a composite phase error signal for controlling ring oscillator 340, as previously described. In a further embodiment, summation 935 is performed by a weighted summation node comparable to the previously-described MIC mixer, the different selected weights of said summation allowing further control of PLL static and dynamic operational characteristics. Alternatively, each XOR output may be used to drive a separate transistor circuit for injecting or removing charge from a capacitive element to achieve the summation. In addition, the PLL 340 of FIG. 9 may be configured to provide a desired phase offset, where the interpolated phases each have the same offset relative the tap delay line signal to which it will be XOR compared.
In some system environments, the described multi-phase reference clock may be directly available from the receiver, as one example where the communications protocol incorporates multiple clock signals.
The additional feedback information provided by the multiple comparison operations may also be obtained without the previously-described DLL front end. FIG. 10 shows an embodiment in which the single received reference signal 1018 enters multi-phase comparator 920 in which the single received reference signal is compared to each of two or more phases of local clock signal 965. In one embodiment, XOR partial phase comparators form partial phase error signals by comparing the phase of the single received reference clock phase 918 with a different phase of the local clock signal 965 from phase interpolator 360. Each partial phase error signal may be converted to an analog signal value, all such analog partial phase error signals being summed to produce a composite phase error signal for controlling ring oscillator 340, as previously described. In a further embodiment, summation 935 is performed by a weighted summation node comparable to the previously described MIC mixer, the different selected weights of said summation allowing further control of PLL static and dynamic operational characteristics. In particular, such weight adjustments may be used to produce additional closed-loop poles and/or zeroes in the PLL time domain transfer function, providing additional control of loop stability.
 FIG. 14A is a timing diagram of a reference signal CKREF being compared with four phases of the VCO (feedback from the PLL):
XOR(CKREF, VCO′000)
XOR(CKREF, VCO′090)
XOR(CKREF, VCO′180)
XOR(CKREF, VCO′270)
As shown in FIG. 14A, it is assumed all weights are equal, however this is purely for illustrative purposes, and should not be considered limiting in any way. FIG. 14A further includes a summation of the four XOR outputs. As can be seen, in lock condition, the integral of the bottom waveform is zero, and the PLL will lock properly. For convenience, FIG. 14B has been included to illustrate a conventional XOR based phase comparators in which the reference is compared to only one VCO phase. In lock position, the reference and VCO are 90-degree phase shifted, and the output of XOR is a rectangular waveform with an average value equal to zero. One may observe how the two waveforms (simple XOR in the FIG. 14B and array-XOR in FIG. 14A) differ from each other; however in both cases the average value for a given period is zero, and the PLL locks. In embodiments utilizing an array of partial phase comparators, a larger number of transitions occur with respect to a single XOR phase comparator. As each transition carries information about an edge, a larger number of transitions means that phase comparator has been able to collect more information from VCO and CKREF.
It should be noted that in array-XOR embodiments, some comparisons might be done using XNORs. As such, an XOR or XNOR for different phase comparisons may be selected carefully to ensure system stability.
In at least one embodiment, the weights of said summation are configured such that they decline in proportion to the timing difference of the comparison clock phase relative to the PLL “normal lock” phase. As one example offered without limitation, if ph090 is the normal lock phase of the PLL, the comparison of ph090 and the received reference signal is weighted 1; comparisons of ph000 and ph180 (e.g. one tap offset from the normal lock phase) are weighted ½; comparison of the received reference signal and ph270 (two tap offsets from the normal lock phase) is weighed ¼; etc. These various weighted comparison results are then summed to produce a composite signal which when low pass filtered 330, is the Error value controlling PLL VCO 340.
In at least one embodiment utilizing multiple phase comparators, the deterministic jitter produced by the multiple phase comparisons was seen to occur at a 12.5 GHz rate with equal phase comparator weights. Even though the amount of jitter was very small and the jitter rate was well above the loop filter cutoff frequency, the deterministic jitter was significantly reduced with the described weight adjustments, in which weight magnitudes decline in proportion to their offset distance from the primary reference signal sample. In some embodiments, different weighted values are used in a comparator circuit to construct a discrete time domain filter. This property can be used to simplify the design of analog filter 330. For example, with proper weighting values one might construct a discrete time domain zero in the transfer function that provides conditions to make the loop robust.
As with previously described examples, other embodiments may be obtained by equivalent combination of phase comparator, phase interpolator, and charge pump elements.
Matrix Phase Comparisons
The multi-phase comparison of multiple phases derived from a received reference signal and multiple phases derived from the local PLL clock may be generalized into a matrix phase comparator, one embodiment of which is shown in FIG. 11B, with one embodiment of each individual phase comparator 1110 (which may be referred to in FIG. 11B as a partial phase comparator) in the matrix shown in FIG. 11A as single-phase comparator 1110. For descriptive purposes, partial phase comparators arranged in a four by four matrix are illustrated, with no limitation implied by those illustrative choices. Embodiments may be organized into rectangular, square, or sparse matrices of any dimensions M and N, with elements of the matrix being composed of any partial phase comparator described herein and optionally any weighting factor computation described herein. As used herein, a sparse matrix is any embodiment in which at least one of the described element weights is zero.
In a full matrix comparison, each of M phases derived from the received reference signal is separately phase compared with each of the N phases derived from the local clock, which may be received from a PLL, or alternatively directly from a VCO or various other clock sources. For purposes of illustration, the N phases of the local clock are received from the PLL. Each resulting phase error signal is weighted by a configured or predetermined amount, with all (M*N) weighted results summed to produce an aggregate error result. An example of one phase comparator is shown in FIG. 11A as 1110, composed of XOR phase comparator 1112 feeding to result weighting factor 1118.
An embodiment of the complete matrix phase comparator 1120 in FIG. 11B is composed of M*N instances of partial phase comparator 1110, each partial phase comparator accepting one of the M phases of the reference signal, herein identified as CkRef0, CkRef1, CkRef2, CkRef3, and one of the N phases of the local clock phase inputs herein identified as CkPLL0, CkPLL1, CkPLL2, CkPLL3, and producing a weighted result e.g. multiple partial phase error signals 1131, 1132, 1133, 1134 as input to summation 935, which produces a composite phase error signal 1145.
One familiar with the art will observe that the previously-described multi-phase comparator 920 of FIG. 9 is equivalent to a partially-populated instance of the present matrix comparator, i.e. having comparators instantiated across a diagonal of the matrix. Functionally, an identical result may be obtained from a full matrix by setting the weights along such a diagonal to a nonzero value, and all other comparator weights to zero. It thus follows that other described behaviors including simulation of phase offsets, introduction of loop time domain zeroes, etc. may be similarly be obtained by selective configuration of matrix weighting factors.
 FIG. 15 illustrates a flowchart of method 1500, in accordance with some embodiments. As shown, method 1500 includes receiving N phases of a local clock signal and M phases of a reference signal at block 1502, wherein M is an integer greater than or equal to 1 and N is an integer greater than or equal to 2. The method further includes generating a plurality of partial phase error signals at block 1504, each partial phase error signal formed at least in part by comparing (i) a respective phase of the M phases of the reference signal to (ii) a respective phase of the N phases of the local clock signal. At block 1506, a composite phase error signal is generated by summing the plurality of partial phase error signals, and responsively a fixed phase of a local oscillator is adjusted 1508 using the composite phase error signal.
In some embodiments, M=1, and N partial phase error signals are summed to generate the composite phase error signal. Alternatively, the plurality of partial phase error signals includes M=N partial phase error signals, and a given phase of the N phases of the local clock signal and a given phase of the M phases of the reference signal are each used to generate a single partial phase error signal. In further alternative embodiments, the plurality of partial phase error signals comprises M×N partial phase error signals, and each phase of the N phases of the local clock signal is compared to each phase of the M phases of the reference signal.
In some embodiments, each partial phase error signal of the plurality of partial phase error signals has a corresponding weight applied to it.
In some embodiments, the M phases of the reference signal are received from a delay-lock loop operating on an input reference signal.
In some embodiments, at least one of the N phases of the local clock signal is generated using a phase interpolator operating on local oscillator signals and a phase offset signal. In some embodiments, at least one of the N phases of the local clock signal comprises interpolating 4 phases using 4 differential pairs in the phase interpolator, each of the 4 phases being interpolated according to a corresponding differential pair connected to an independently tunable current source.
In some embodiments, at least one partial phase error signal is generated using a pair of flip-flops, wherein a first flip-flop of the pair of flip-flops is clocked using a given phase of the M phases of the reference signal and a second flip-flop is clocked using a given phase of the N phases of the local clock signal.
In some embodiments, each partial phase error signal is an analog signal generated using a respective charge pump, the respective charge pump receiving respective charge pump control signals generated by a respective comparison between the respective phase of the M phases of the reference signal and the respective phase of the N phases of the local clock signal.
Alternative Embodiments
The clock signal received from MIC5 in FIG. 2 after being transported over two dedicated clock wires could just as easily be received from, as one example MIC4, having been transported as one subchannel of the vector signaling code also carrying the data. This method of embedding the clock in a vector signaling code subchannel is described in [Shokrollahi II] and [Holden III]. All of the described clock embedding embodiments therein may be beneficially combined with the PLL and timing control mechanisms described herein, without limitation.
Similarly, known methods of communicating a clock signal using edge transitions of the data lines may be combined with the PLL and timing control mechanisms described herein. In particular, vector signaling codes with guaranteed transition density over time, such as taught by [Shokrollahi I] are amenable to such combination.

The invention claimed is:
 
1. A method comprising:
receiving N phases of a local clock signal and M phases of a reference signal, wherein M is an integer greater than or equal to 1 and N is an integer greater than or equal to 2;
generating a plurality of partial phase error signals, wherein each partial phase error signal is an analog signal generated using a respective charge pump, the respective charge pump receiving respective charge pump control signals generated by a respective comparison between (i) a respective phase of the M phases of the reference signal to (ii) a respective phase of the N phases of the local clock signal; and
generating a composite phase error signal by summing the plurality of partial phase error signals, and responsively adjusting a fixed phase of a local oscillator using the composite phase error signal.


  
2. The method of claim 1, wherein M=1, and N partial phase error signals are summed to generate the composite phase error signal.

  
3. The method of claim 1, wherein the plurality of partial phase error signals comprises M=N partial phase error signals, and wherein a given phase of the N phases of the local clock signal and a given phase of the M phases of the reference signal are each used to generate a single partial phase error signal.

  
4. The method of claim 1, wherein the plurality of partial phase error signals comprises M×N partial phase error signals, and wherein each phase of the N phases of the local clock signal is compared to each phase of the M phases of the reference signal.

  
5. The method of claim 1, wherein each partial phase error signal of the plurality of partial phase error signals has a corresponding weight applied to it.

  
6. The method of claim 1, wherein the M phases of the reference signal are received from a delay-lock loop operating on an input reference signal.

  
7. The method of claim 1, wherein at least one of the N phases of the local clock signal is generated using a phase interpolator operating on local oscillator signals and a phase offset signal.

  
8. The method of claim 7, wherein generating at least one of the N phases of the local clock signal comprises interpolating 4 phases using 4 differential pairs in the phase interpolator, each of the 4 phases being interpolated according to a corresponding differential pair connected to an independently tunable current source.

  
9. The method of claim 1, wherein the respective charge pump control signals for each respective charge pump are further generated using a respective pair of flip-flops, wherein a first flip-flop of the respective pair of flip-flops is clocked using the respective phase of the M phases of the reference signal and a second flip-flop of the respective pair of flip flops is clocked using the respective phase of the N phases of the local clock signal.

  
10. The method of claim 1, wherein each phase of the N phases of the local clock signal are received via respective taps of a plurality of taps of a local oscillator.

  
11. An apparatus comprising:
a multi-phase comparator configured to receive N phases of a local clock signal and M phases of a reference signal, wherein M is an integer greater than or equal to 1 and N is an integer greater than or equal to 2, the multi-phase comparator comprising:
a plurality of partial phase comparators configured to generate a plurality of partial phase error signals, wherein the plurality partial phase comparators comprise respective charge pumps configured to generate each partial phase error signal as an analog signal according to respective charge pump control signals generated by a respective comparison between (i) a respective phase of the M phases of the reference signal to (ii) a respective phase of the N phases of the local clock signal; and

a summation circuit configured to generate a composite phase error signal by summing the plurality of partial phase error signals, the composite phase error signal for adjusting a fixed phase of a local oscillator.


  
12. The apparatus of claim 11, wherein M=1, and wherein the multi-phase comparator comprises N partial phase comparators configured to generate N partial phase error signals.

  
13. The apparatus of claim 11, wherein the multi-phase comparator comprises M=N partial phase comparators, each partial phase comparator configured to generate a partial phase error signal by comparing a respective phase of the N phases of the local clock feedback signal and a respective phase of the M phases of the reference signal.

  
14. The apparatus of claim 11, wherein the multi-phase comparator comprises M×N partial phase comparators, the multi-phase comparator configured to compare each phase of the N phases of the local clock signal to each phase of the M phases of the reference signal.

  
15. The apparatus of claim 11, wherein each partial phase error signal of the plurality of partial phase error signals has a corresponding weight applied to it.

  
16. The apparatus of claim 11, further comprising a delay-lock loop configured to operate on an input reference signal and to generate the M phases of the reference signal.

  
17. The apparatus of claim 11, further comprising a phase interpolator configured to operate on local oscillator signals and a phase offset signal to generate at least one of the N phases of the local clock signal.

  
18. The apparatus of claim 17, wherein the phase interpolator is configured to generate at least one of the N phases of the local clock signal by interpolating 4 phases using 4 differential pairs in the phase interpolator, each of the 4 phases being interpolated according to a corresponding differential pair connected to an independently tunable current source.

  
19. The apparatus of claim 11, further comprising a respective pair of flip-flops configured to generate each respective charge pump control signals for each respective charge pump, wherein a first flip-flop of the respective pair of flip-flops is clocked using the respective phase of the M phases of the reference signal and a second flip-flop of the respective pair of flip-flops is clocked using the respective phase of the N phases of the local clock signal.

  
20. The apparatus of claim 11, further comprising a local oscillator configured to provide the N phases of the local clock signal to the multi-phase comparator, each phase of the N phases of the local clock signal provided via a respective tap of a plurality of taps of a local oscillator.